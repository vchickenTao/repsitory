**<span style="font-size: 35px;">ğŸ‰ MySQL åŸºç¡€ç¯‡ -Â å­æŸ¥è¯¢</span>**

---

# å­æŸ¥è¯¢

## 1. åŸºæœ¬ä½¿ç”¨

+ å­æŸ¥è¯¢çš„åŸºæœ¬è¯­æ³•ç»“æ„ï¼š

![image-20220603133759153](MySQLåŸºç¡€ç¯‡.assets/image-20220603133759153.png)

+ å­æŸ¥è¯¢ï¼ˆå†…æŸ¥è¯¢ï¼‰åœ¨ä¸»æŸ¥è¯¢ä¹‹å‰ä¸€æ¬¡æ‰§è¡Œå®Œæˆã€‚
+ å­æŸ¥è¯¢çš„ç»“æœè¢«ä¸»æŸ¥è¯¢ï¼ˆå¤–æŸ¥è¯¢ï¼‰ä½¿ç”¨ ã€‚
+ **æ³¨æ„äº‹é¡¹**
  + å­æŸ¥è¯¢è¦åŒ…å«åœ¨æ‹¬å·å†…
  + å°†å­æŸ¥è¯¢æ”¾åœ¨æ¯”è¾ƒæ¡ä»¶çš„å³ä¾§
  + å•è¡Œæ“ä½œç¬¦å¯¹åº”å•è¡Œå­æŸ¥è¯¢ï¼Œå¤šè¡Œæ“ä½œç¬¦å¯¹åº”å¤šè¡Œå­æŸ¥è¯¢

## 2. å­æŸ¥è¯¢çš„åˆ†ç±»

**åˆ†ç±»æ–¹å¼1ï¼š**

æˆ‘ä»¬æŒ‰å†…æŸ¥è¯¢çš„ç»“æœè¿”å›ä¸€æ¡è¿˜æ˜¯å¤šæ¡è®°å½•ï¼Œå°†å­æŸ¥è¯¢åˆ†ä¸º å•è¡Œå­æŸ¥è¯¢ ã€ å¤šè¡Œå­æŸ¥è¯¢ ã€‚

+ å•è¡Œå­æŸ¥è¯¢

![image-20220603135507360](MySQLåŸºç¡€ç¯‡.assets/image-20220603135507360.png)

+ å¤šè¡Œå­æŸ¥è¯¢

![image-20220603135544144](MySQLåŸºç¡€ç¯‡.assets/image-20220603135544144.png)

**åˆ†ç±»æ–¹å¼2ï¼š**

æˆ‘ä»¬æŒ‰å†…æŸ¥è¯¢æ˜¯å¦è¢«æ‰§è¡Œå¤šæ¬¡ï¼Œå°†å­æŸ¥è¯¢åˆ’åˆ†ä¸º ç›¸å…³(æˆ–å…³è”)å­æŸ¥è¯¢ å’Œ ä¸ç›¸å…³(æˆ–éå…³è”)å­æŸ¥è¯¢ ã€‚ 

å­æŸ¥è¯¢ä»æ•°æ®è¡¨ä¸­æŸ¥è¯¢äº†æ•°æ®ç»“æœï¼Œå¦‚æœè¿™ä¸ªæ•°æ®ç»“æœåªæ‰§è¡Œä¸€æ¬¡ï¼Œç„¶åè¿™ä¸ªæ•°æ®ç»“æœä½œä¸ºä¸»æŸ¥è¯¢çš„æ¡ä»¶è¿›è¡Œæ‰§è¡Œï¼Œé‚£ä¹ˆè¿™æ ·çš„å­æŸ¥è¯¢å«åšä¸ç›¸å…³å­æŸ¥è¯¢ã€‚ 

åŒæ ·ï¼Œå¦‚æœå­æŸ¥è¯¢éœ€è¦æ‰§è¡Œå¤šæ¬¡ï¼Œå³é‡‡ç”¨å¾ªç¯çš„æ–¹å¼ï¼Œå…ˆä»å¤–éƒ¨æŸ¥è¯¢å¼€å§‹ï¼Œæ¯æ¬¡éƒ½ä¼ å…¥å­æŸ¥è¯¢è¿›è¡ŒæŸ¥è¯¢ï¼Œç„¶åå†å°†ç»“æœåé¦ˆç»™å¤–éƒ¨ï¼Œè¿™ç§åµŒå¥—çš„æ‰§è¡Œæ–¹å¼å°±ç§°ä¸ºç›¸å…³å­æŸ¥è¯¢ã€‚

## 3. å•è¡Œå­æŸ¥è¯¢

### 1) å•è¡Œæ¯”è¾ƒæ“ä½œç¬¦

| æ“ä½œç¬¦ | å«ä¹‰                     |
| ------ | ------------------------ |
| =      | equal to                 |
| >      | greater than             |
| >=     | greater than or equal to |
| <      | less than                |
| <=     | less than or equal to    |
| <>     | not equal to             |

### 2) ä»£ç ç¤ºä¾‹

* é¢˜ç›®ï¼šè¿”å›job_idä¸141å·å‘˜å·¥ç›¸åŒï¼Œsalaryæ¯”143å·å‘˜å·¥å¤šçš„å‘˜å·¥å§“åï¼Œjob_idå’Œå·¥èµ„

```mysql
SELECT last_name, job_id, salary
FROM eployees
WHERE job_id = (
	SELECT job_id
	FROM eployees
    WHERE employee_id = 141
)
AND salary > (
	SELECT salary
	FROM eployees
    WHERE employee_id = 143
);
```

* é¢˜ç›®ï¼šæŸ¥è¯¢ä¸141å·æˆ–174å·å‘˜å·¥çš„manager_idå’Œdepartment_idç›¸åŒçš„å…¶ä»–å‘˜å·¥çš„employee_idï¼Œ manager_idï¼Œdepartment_id

```mysql
# å®ç°æ–¹å¼ä¸€ï¼šä¸æˆå¯¹æ¯”è¾ƒ
SELECT employee_id, manager_id, department_id
FROM employees
WHERE manager_id IN
        (SELECT manager_id
        FROM employees
        WHERE employee_id IN (174,141))
AND department_id IN
        (SELECT department_id
        FROM employees
        WHERE employee_id IN (174,141))
AND employee_id NOT IN(174,141);

# å®ç°æ–¹å¼äºŒï¼šæˆå¯¹æ¯”è¾ƒ
SELECT employee_id, manager_id, department_id
FROM employees
WHERE (manager_id, department_id) IN
        (SELECT manager_id, department_id
        FROM employees
        WHERE employee_id IN (141,174))
AND employee_id NOT IN (141,174);
```

* é¢˜ç›®ï¼šæŸ¥è¯¢æœ€ä½å·¥èµ„å¤§äº50å·éƒ¨é—¨æœ€ä½å·¥èµ„çš„éƒ¨é—¨idå’Œå…¶æœ€ä½å·¥èµ„

```mysql
SELECT department_id, MIN(salary)
FROM employees
GROUP BY department_id
HAVING MIN(salary) >
            (SELECT MIN(salary)
            FROM employees
            WHERE department_id = 50);
```

### 3) CASEä¸­çš„å­æŸ¥è¯¢

é¢˜ç›®ï¼šæ˜¾å¼å‘˜å·¥çš„employee_id,last_nameå’Œlocationã€‚å…¶ä¸­ï¼Œè‹¥å‘˜å·¥department_idä¸location_idä¸º1800 çš„department_idç›¸åŒï¼Œåˆ™locationä¸ºâ€™Canadaâ€™ï¼Œå…¶ä½™åˆ™ä¸ºâ€™USAâ€™ã€‚

```mysql
SELECT employee_id, last_name,
    (CASE department_id
    WHEN
        (SELECT department_id FROM departments
        WHERE location_id = 1800)
    THEN 'Canada' ELSE 'USA' END) location
FROM employees;
```

### 4) å­æŸ¥è¯¢ä¸­çš„ç©ºå€¼é—®é¢˜

```mysql
SELECT last_name, job_id
FROM employees
WHERE job_id =
(SELECT job_id
FROM employees
WHERE last_name = 'Haas');
```

> å­æŸ¥è¯¢ä¸è¿”å›ä»»ä½•è¡Œ

### 5) éæ³•ä½¿ç”¨å­æŸ¥è¯¢

```mysql
SELECT employee_id, last_name
FROM employees
WHERE salary =
(SELECT MIN(salary)
FROM employees
GROUP BY department_id);
```

> å¤šè¡Œå­æŸ¥è¯¢ä½¿ç”¨å•è¡Œæ¯”è¾ƒç¬¦

## 4. å¤šè¡Œå­æŸ¥è¯¢

* ä¹Ÿç§°ä¸ºé›†åˆæ¯”è¾ƒå­æŸ¥è¯¢
* å†…æŸ¥è¯¢è¿”å›å¤šè¡Œ
* ä½¿ç”¨å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦

### 1) å¤šè¡Œæ¯”è¾ƒæ“ä½œç¬¦

| æ“ä½œç¬¦ | å«ä¹‰                                                     |
| ------ | -------------------------------------------------------- |
| IN     | ç­‰äºåˆ—è¡¨ä¸­çš„ä»»æ„ä¸€ä¸ª                                     |
| ANY    | éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå’Œå­æŸ¥è¯¢è¿”å›çš„æŸä¸€ä¸ªå€¼æ¯”è¾ƒ |
| ALL    | éœ€è¦å’Œå•è¡Œæ¯”è¾ƒæ“ä½œç¬¦ä¸€èµ·ä½¿ç”¨ï¼Œå’Œå­æŸ¥è¯¢è¿”å›çš„æ‰€æœ‰å€¼æ¯”è¾ƒ   |
| SOME   | å®é™…ä¸Šæ˜¯ANYçš„åˆ«åï¼Œä½œç”¨ç›¸åŒï¼Œä¸€èˆ¬å¸¸ä½¿ç”¨ANY               |

### 2) ä»£ç ç¤ºä¾‹

* é¢˜ç›®ï¼šè¿”å›å…¶å®ƒjob_idä¸­æ¯”job_idä¸ºâ€˜IT_PROGâ€™éƒ¨é—¨ä»»ä¸€å·¥èµ„ä½çš„å‘˜å·¥çš„å‘˜å·¥å·ã€å§“åã€job_id ä»¥åŠsalary

```mysql
SELECT employee_id, last_name, job_id, salary
FROM employees
WHERE job_id <> 'IT_PROG' 
AND salary < ANY(
	SELECT salary
    FROM emplyees
    WHERE job_id = 'IT_PROG'
);
```

* é¢˜ç›®ï¼šæŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨id

```mysql
#æ–¹å¼1ï¼š
SELECT department_id
FROM employees
GROUP BY department_id
HAVING AVG(salary) = (
        SELECT MIN(avg_sal)
        FROM (
            SELECT AVG(salary) avg_sal
            FROM employees
            GROUP BY department_id
            ) dept_avg_sal
);
```

```mysql
#æ–¹å¼2ï¼š
SELECT department_id
FROM employees
GROUP BY department_id
HAVING AVG(salary) <= ALL (
        SELECT AVG(salary) avg_sal
        FROM employees
        GROUP BY department_id
);
```

### 3) ç©ºå€¼é—®é¢˜

```mysql
SELECT last_name
FROM employees
WHERE employee_id NOT IN (
    SELECT manager_id
    FROM employees
    WHERE manager_id IS NOT NULL
);
```

## 5. ç›¸å…³å­æŸ¥è¯¢

å¦‚æœå­æŸ¥è¯¢çš„æ‰§è¡Œä¾èµ–äºå¤–éƒ¨æŸ¥è¯¢ï¼Œé€šå¸¸æƒ…å†µä¸‹éƒ½æ˜¯å› ä¸ºå­æŸ¥è¯¢ä¸­çš„è¡¨ç”¨åˆ°äº†å¤–éƒ¨çš„è¡¨ï¼Œå¹¶è¿›è¡Œäº†æ¡ä»¶ å…³è”ï¼Œå› æ­¤æ¯æ‰§è¡Œä¸€æ¬¡å¤–éƒ¨æŸ¥è¯¢ï¼Œå­æŸ¥è¯¢éƒ½è¦é‡æ–°è®¡ç®—ä¸€æ¬¡ï¼Œè¿™æ ·çš„å­æŸ¥è¯¢å°±ç§°ä¹‹ä¸º å…³è”å­æŸ¥è¯¢ ã€‚ 

ç›¸å…³å­æŸ¥è¯¢æŒ‰ç…§ä¸€è¡Œæ¥ä¸€è¡Œçš„é¡ºåºæ‰§è¡Œï¼Œä¸»æŸ¥è¯¢çš„æ¯ä¸€è¡Œéƒ½æ‰§è¡Œä¸€æ¬¡å­æŸ¥è¯¢ã€‚

![image-20220603154919387](MySQLåŸºç¡€ç¯‡.assets/image-20220603154919387.png)

![image-20220603155013864](MySQLåŸºç¡€ç¯‡.assets/image-20220603155013864.png)

> è¯´æ˜ï¼šå­æŸ¥è¯¢ä¸­ä½¿ç”¨ä¸»æŸ¥è¯¢ä¸­çš„åˆ—

### 1) ä»£ç ç¤ºä¾‹

* é¢˜ç›®ï¼šæŸ¥è¯¢å‘˜å·¥ä¸­å·¥èµ„å¤§äºæœ¬éƒ¨é—¨å¹³å‡å·¥èµ„çš„å‘˜å·¥çš„last_name,salaryå’Œå…¶department_id

```mysql
# æ–¹å¼ä¸€ï¼šä½¿ç”¨ç›¸å…³å­æŸ¥è¯¢
SELECT last_name, salary, department
FROM employees e1
WHERE salary > (
		SELECT AVG(salary)
    	FROM employees e2
    	WHERE department_id = e1.`department_id`
);
# æ–¹å¼äºŒï¼šåœ¨FROMä¸­å£°æ˜å­æŸ¥è¯¢
SELECT e.last_name, e.salary, e.department_id
FROM employees e, (
    			SELECT department_id, AVG(salary) avg_sal
    			FROM employees
    			GROUP BY department_id) t_dept_avg_salary
WHERE e.department_id = t_dept_avg_salary.department_id
AND e.salary > t_dept_avg_salary.avg_sal;
```

åœ¨ORDER BY ä¸­ä½¿ç”¨å­æŸ¥è¯¢ï¼š

* æŸ¥è¯¢å‘˜å·¥çš„id,salary,æŒ‰ç…§department_name æ’åº

```mysql
SELECT employee_id, salary
FROM employees e
ORDER BY (
	SELECT department_name
    FROM departments d
    WHERE e.`department_id` = d.`department_id`
);
```

* é¢˜ç›®ï¼šè‹¥employeesè¡¨ä¸­employee_idä¸job_historyè¡¨ä¸­employee_idç›¸åŒçš„æ•°ç›®ä¸å°äº2ï¼Œè¾“å‡ºè¿™äº›ç›¸åŒ idçš„å‘˜å·¥çš„employee_id,last_nameå’Œå…¶job_id

```mysql
SELECT e.employee_id, last_name,e.job_id
FROM employees e
WHERE 2 <= (SELECT COUNT(*)
        FROM job_history
        WHERE employee_id = e.employee_id
);
```

### 2) EXISTS ä¸ NOT EXISTS å…³é”®å­—

* å…³è”å­æŸ¥è¯¢é€šå¸¸ä¹Ÿä¼šå’Œ EXISTSæ“ä½œç¬¦ä¸€èµ·æ¥ä½¿ç”¨ï¼Œç”¨æ¥æ£€æŸ¥åœ¨å­æŸ¥è¯¢ä¸­æ˜¯å¦å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œã€‚
* å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­ä¸å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œï¼š
  + æ¡ä»¶è¿”å› FALSE
  + ç»§ç»­åœ¨å­æŸ¥è¯¢ä¸­æŸ¥æ‰¾
* å¦‚æœåœ¨å­æŸ¥è¯¢ä¸­å­˜åœ¨æ»¡è¶³æ¡ä»¶çš„è¡Œï¼š
  + ä¸åœ¨å­æŸ¥è¯¢ä¸­ç»§ç»­æŸ¥æ‰¾
  + æ¡ä»¶è¿”å› TRUE
* NOT EXISTSå…³é”®å­—è¡¨ç¤ºå¦‚æœä¸å­˜åœ¨æŸç§æ¡ä»¶ï¼Œåˆ™è¿”å›TRUEï¼Œå¦åˆ™è¿”å›FALSEã€‚

é¢˜ç›®ï¼šæŸ¥è¯¢å…¬å¸ç®¡ç†è€…çš„employee_idï¼Œlast_nameï¼Œjob_idï¼Œdepartment_idä¿¡æ¯

```mysql
# æ–¹å¼ä¸€ï¼šEXISTS
SELECT employee_id, last_name, job_id, department_id
FROM employees e1
WHERE EXISTS ( SELECT *
        FROM employees e2
        WHERE e2.manager_id =
        e1.employee_id
);

# æ–¹å¼äºŒï¼šè‡ªè¿æ¥
SELECT DISTINCT e1.employee_id, e1.last_name, e1.job_id, e1.department_id
FROM employees e1 JOIN employees e2
ON e1.employee_id = e2.manager_id;

# æ–¹å¼ä¸‰ï¼šIN
SELECT employee_id, last_name, job_id, department_id
WHERE employee_id IN (
        SELECT DISTINCT manager_id
        FROM employees
);
```

é¢˜ç›®ï¼šæŸ¥è¯¢departmentsè¡¨ä¸­ï¼Œä¸å­˜åœ¨äºemployeesè¡¨ä¸­çš„éƒ¨é—¨çš„department_idå’Œdepartment_name

```mysql
# æ–¹å¼ä¸€ï¼š
SELECT d.department_id, d.department_name
FROM departments e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE e.`department_id` IS NULL;

# æ–¹å¼äºŒï¼š
SELECT department_id, department_name
FROM departments d
WHERE NOT EXISTS (
	SELECT *
    FROM employees e
    WHERE d.`department_id` = e.`department_id`
);
```

### 3) ç›¸å…³æ›´æ–°

```mysql
UPDATE table1 alias1
SET column = (SELECT expression
FROM table2 alias2
WHERE alias1.column = alias2.column);
```

ä½¿ç”¨ç›¸å…³å­æŸ¥è¯¢ä¾æ®ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®æ›´æ–°å¦ä¸€ä¸ªè¡¨çš„æ•°æ®ã€‚

é¢˜ç›®ï¼šåœ¨employeesä¸­å¢åŠ ä¸€ä¸ªdepartment_nameå­—æ®µï¼Œæ•°æ®ä¸ºå‘˜å·¥å¯¹åº”çš„éƒ¨é—¨åç§°

```mysql
# 1ï¼‰
ALTER TABLE employees
ADD(department_name VARCHAR2(14));

# 2ï¼‰
UPDATE employees e
SET department_name = (SELECT department_name
FROM departments d
WHERE e.department_id = d.department_id);
```

### 4) ç›¸å…³åˆ é™¤

```mysql
DELETE FROM table1 alias1
WHERE column operator (SELECT expression
FROM table2 alias2
WHERE alias1.column = alias2.column);
```

ä½¿ç”¨ç›¸å…³å­æŸ¥è¯¢ä¾æ®ä¸€ä¸ªè¡¨ä¸­çš„æ•°æ®åˆ é™¤å¦ä¸€ä¸ªè¡¨çš„æ•°æ®ã€‚

é¢˜ç›®ï¼šåˆ é™¤è¡¨employeesä¸­ï¼Œå…¶ä¸emp_historyè¡¨çš†æœ‰çš„æ•°æ®

```mysql
DELETE FROM employees e
WHERE employee_id in(
    SELECT employee_id
    FROM emp_history
    WHERE employee_id = e.employee_id
);
```

## 6. æ€è€ƒé¢˜

é—®é¢˜ï¼šè°çš„å·¥èµ„æ¯”Abelçš„é«˜ï¼Ÿ è§£ç­”ï¼š

```mysql
#æ–¹å¼1ï¼šè‡ªè¿æ¥
SELECT e2.last_name,e2.salary
FROM employees e1,employees e2
WHERE e1.last_name = 'Abel'
AND e1.`salary` < e2.`salary`;
```

```mysql
#æ–¹å¼2ï¼šå­æŸ¥è¯¢
SELECT last_name,salary
FROM employees
WHERE salary > (
    SELECT salary
    FROM employees
    WHERE last_name = 'Abel'
);
```

é—®é¢˜ï¼šä»¥ä¸Šä¸¤ç§æ–¹å¼æœ‰å¥½åä¹‹åˆ†å—ï¼Ÿ 

è§£ç­”ï¼šè‡ªè¿æ¥æ–¹å¼å¥½ï¼ 

é¢˜ç›®ä¸­å¯ä»¥ä½¿ç”¨å­æŸ¥è¯¢ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªè¿æ¥ã€‚ä¸€èˆ¬æƒ…å†µå»ºè®®ä½ ä½¿ç”¨è‡ªè¿æ¥ï¼Œå› ä¸ºåœ¨è®¸å¤š DBMS çš„å¤„ç†è¿‡ ç¨‹ä¸­ï¼Œå¯¹äºè‡ªè¿æ¥çš„å¤„ç†é€Ÿåº¦è¦æ¯”å­æŸ¥è¯¢å¿«å¾—å¤šã€‚ å¯ä»¥è¿™æ ·ç†è§£ï¼šå­æŸ¥è¯¢å®é™…ä¸Šæ˜¯é€šè¿‡æœªçŸ¥è¡¨è¿›è¡ŒæŸ¥è¯¢åçš„æ¡ä»¶åˆ¤æ–­ï¼Œè€Œè‡ªè¿æ¥æ˜¯é€šè¿‡å·²çŸ¥çš„è‡ªèº«æ•°æ®è¡¨ è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå› æ­¤åœ¨å¤§éƒ¨åˆ† DBMS ä¸­éƒ½å¯¹è‡ªè¿æ¥å¤„ç†è¿›è¡Œäº†ä¼˜åŒ–ã€‚

## 7. è¯¾åç»ƒä¹ 

1. æŸ¥è¯¢å’ŒZlotkeyç›¸åŒéƒ¨é—¨çš„å‘˜å·¥å§“åå’Œå·¥èµ„

```mysql
SELECT last_name, salary
FROM employees
WHERE department_id = (
	SELECT department_id
    FROM employees
    WHERE last_name = 'Zlotkey'
);
```

2. æŸ¥è¯¢å·¥èµ„æ¯”å…¬å¸å¹³å‡å·¥èµ„é«˜çš„å‘˜å·¥çš„å‘˜å·¥å·ï¼Œå§“åå’Œå·¥èµ„ã€‚

```mysql
SELECT employee_id, last_name, salary
FROM employees
WHERE salary > (
	SELECT AVG(salary)
    FROM employee
);
```

3. é€‰æ‹©å·¥èµ„å¤§äºæ‰€æœ‰JOB_ID = 'SA_MAN' çš„å‘˜å·¥çš„å·¥èµ„çš„å‘˜å·¥çš„last_name, job_id, salary

```mysql
SELECT last_name, job_id, salary
FROM employees
WHERE salary > ALL (
	SELECT salary
    FROM employees
    WHERE job_id = 'SA_MAN'
);
```

4. æŸ¥è¯¢å’Œå§“åä¸­åŒ…å«å­—æ¯uçš„å‘˜å·¥åœ¨ç›¸åŒéƒ¨é—¨çš„å‘˜å·¥çš„å‘˜å·¥å·å’Œå§“å

```mysql
SELECT employee_id, last_name
FROM eployees
WHERE department_id IN (
    SELECT DISTINCT department_id
    FROM employees
    WHERE last_name LIKE '%u%'
);
```

5. æŸ¥è¯¢åœ¨éƒ¨é—¨çš„location_idä¸º1700çš„éƒ¨é—¨å·¥ä½œçš„å‘˜å·¥çš„å‘˜å·¥å·

```mysql
SELECT employee_id
FROM employees
WHERE department_id IN (
	SELECT department_id
    FROM departments
    WHERE location_id = 1700
);
```

6. æŸ¥è¯¢ç®¡ç†è€…æ˜¯Kingçš„å‘˜å·¥å§“åå’Œå·¥èµ„

```mysql
SELECT last_name, salary
FROM employees
WHERE manage_id IN (
	SELECT employee_id
    FROM employees
    WHERE last_name = 'King'
);
```

7. æŸ¥è¯¢å·¥èµ„æœ€ä½çš„å‘˜å·¥ä¿¡æ¯ (last_name, salary)

```mysql
SELECT last_name, salary
FROM employees
WHERE salary = (
	SELECT MIN(salary)
    FROM employees
);
```

8. æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨ä¿¡æ¯

```mysql
# æ–¹å¼ä¸€
SELECT *
FROM departments
WHERE department_id = (
	SELECT department_id
    FROM employees
    GROUP BY department_id
    HAVING AVG(salary) = (
    	SELECT MIN(avg_sal)
        FROM (
        	SELECT AVG(salary) avg_sal
            FROM employees
            GROUP BY department_id
        ) t_dept_avg_sal
    )
);

# æ–¹å¼äºŒ
SELECT *
FROM departments
WHERE department_id = (
	SELECT department_id
    FROM employees
    GROUP BY department_id
    HAVING AVG(salary) <= ALL (
        SELECT AVG(salary) avg_sal
        FROM employees
        GROUP BY department_id
    )
);

# æ–¹å¼ä¸‰: LIMIT
SELECT *
FROM departments
WHERE department_id IN (
    SELECT department_id
    FROM employees
    GROUP BY department_id
    HAVING AVG(salary) = (
    	SELECT AVG(salary) avg_sal
        FROM employees
        GROUP BY department_id
        ORDER BY avg_sal ASC
        LIMIT 1
    )
);

# æ–¹å¼å››
SELECT d.*
FROM departments d, (
	SELECT department_id, AVG(salary) avg_sal
    FROM employees
    GROUP BY department_id
    ORDER BY avg_sal ASC
    LIMIT 0,1
) t_dept_avg_sal
WHERE d.`department_id` = t_dept_avg_sal.`department_id`;
```

9. æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€ä½çš„éƒ¨é—¨ä¿¡æ¯å’Œè¯¥éƒ¨é—¨çš„å¹³å‡å·¥èµ„ (ç›¸å…³å­æŸ¥è¯¢)

```mysql
SELECT d.*, (SELECT AVG(salary) FROM employees WHERE department_id = d.`department_id`) avg_sal
FROM departments d, (
	SELECT department_id, AVG(salary) avg_sal
    FROM employees
    GROUP BY department_id
    ORDER BY avg_sal ASC
    LIMIT 0,1
) t_dept_avg_sal
WHERE d.`department_id` = t_dept_avg_sal.`department_id`;
```

10. æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„jobä¿¡æ¯

```mysql
SELECT *
FROM jobs
WHERE job_id = (
	SELECT job_id
    FROM employees
    GROUP BY job_id
    HAVING AVG(salary) = (
    	SELECT MAX(avg_sal)
        FROM (
        	SELECT AVG(salary) avg_sal
            FROM employees
            GROUP BY job_id
        ) t_job_avg_sal
    )
);
```

11. æŸ¥è¯¢å¹³å‡å·¥èµ„é«˜äºå…¬å¸å¹³å‡å·¥èµ„çš„éƒ¨é—¨æœ‰å“ªäº›ï¼Ÿ

```mysql
SELECT depatment_id
FROM employees
WHERE department_id IS NOT NULL
GROUP BY department_id
HAVING AVG(salary) > (
	SELECT AVG(salary)
    FROM eployees
);
```

12. æŸ¥è¯¢å‡ºå…¬å¸ä¸­æ‰€æœ‰managerçš„è¯¦ç»†ä¿¡æ¯

```mysql
# æ–¹å¼1ï¼šè‡ªè¿æ¥
SELECT DISTINCT *
FROM employees emp, employees manager
WHERE emp.`manager_id` = manager.`employee_id`;

SELECT DISTINCT *
FROM employees emp JOIN employees manager
ON emp.`manager_id` = manager.`employee_id`; 

# æ–¹å¼2ï¼šå­æŸ¥è¯¢
SELECT *
FROM employees
WHERE employee_id IN (
	SELECT manager_id
    FROM employees
);

# æ–¹å¼3ï¼šEXISTS
SELECT *
FROM employees manager
WHERE EXISTS (
	SELECT *
    FROM employees emp
    WHERE manager.`employee_id` = emp.`manager_id`
);
```

13. å„ä¸ªéƒ¨é—¨ä¸­ï¼Œæœ€é«˜å·¥èµ„ä¸­æœ€ä½çš„é‚£ä¸ªéƒ¨é—¨çš„æœ€ä½å·¥èµ„æ˜¯å¤šå°‘ï¼Ÿ

```mysql
# æ–¹å¼ä¸€ï¼š
SELECT MIN(salary)
FROM employees
WHERE department_id = (
    SELECT department_id
    FROM employees
	GROUP BY department_id
	HAVING MAX(salary) = (
    	SELECT MIN(max_sal)
        FROM (
        	SELECT MAX(salary) max_sal
            FROM employees
            GROUP BY department_id
        ) t_dept_max_sal
    ) 
);

# æ–¹å¼äºŒï¼š
SELECT MIN(salary)
FROM employees
WHERE department_id = (
    SELECT department_id
    FROM employees
	GROUP BY department_id
	HAVING MAX(salary) <= ALL (
        SELECT MAX(salary)
        FROM employees
        GROUP BY department_id
    ) 
);

# æ–¹å¼ä¸‰ï¼š
SELECT MIN(salary)
FROM employees
WHERE department_id = (
    SELECT department_id
    FROM employees
	GROUP BY department_id
	HAVING MAX(salary) = (
        SELECT MAX(salary) max_sal
        FROM employees
        GROUP BY department_id
        ORDER BY max_sal ASC
        LIMIT 0,1
    ) 
);

# æ–¹å¼å››ï¼š
FROM employees e, (
	SELECT department_id, MAX(salary) max_sal
    FROM employees
    GROUP BY department_id
    ORDER BY max_sal ASC
    LIMIT 0,1
) t_dept_max_sal
WHERE e.`department_id` = t_dept_max_sal.`department_id`;
```

14. æŸ¥è¯¢å¹³å‡å·¥èµ„æœ€é«˜çš„éƒ¨é—¨çš„managerçš„è¯¦ç»†ä¿¡æ¯ï¼šlast_name, department_id, email, salary

```mysql
SELECT last_name, department_id, email, salary
FROM employees
WHERE employee_id IN (
	SELECT DISTINCT manager_id
    FROM employees
    WHERE department_id = (
    	SELECT department_id
        FROM employees
        GROUP BY department_id
        HAVING AVG(salary) = (
        	SELECT MAX(avg_sal)
            FROM (
            	SELECT AVG(salary) avg_sal
                FROM employees
                GROUP BY department_id
            ) t_dept_avg_sal
        )
    )
);

SELECT last_name, department_id, email, salary
FROM employees
WHERE employee_id IN (
    SELECT DISTINCT manager_id
    FROM employees e, (
        SELECT department_id, AVG(salary) avg_sal
        FROM employees
        GROUP BY department_id
        ORDER BY avg_sal DESC
        LIMIT 0,1
    ) t_dept_avg_sal
    WHERE e.`department_id` = t_dept_avg_sal.`department_id`
);
```

15. æŸ¥è¯¢éƒ¨é—¨çš„éƒ¨é—¨å·ï¼Œå…¶ä¸­ä¸åŒ…æ‹¬job_idæ˜¯"ST_CLERK"çš„éƒ¨é—¨å·

```mysql
SELECT department_id
FROM departments
WHERE department_id NOT IN (
	SELECT DISTINCT department_id
    FROM employees
    WHERE job_id = `ST_CLERK`
);

SELECT department_id
FROM department d
WHERE NOT EXISTS (
	SELECT *
    FROM employees e
    WHERE d.`department_id` = e.`department_id`
    AND e.`job_id` = 'ST_CLERK'
);
```

16. é€‰æ‹©æ‰€æœ‰æ²¡æœ‰ç®¡ç†è€…çš„å‘˜å·¥çš„last_name

```mysql
SELECT last_name
FROM employees emp
WHERE NOT EXISTS (
	SELECT *
    FROM employees mgr
    WHERE emp.`manager_id` = mgr.`employee_id`
);
```

17. æŸ¥è¯¢å‘˜å·¥å·ã€å§“åã€é›‡ç”¨æ—¶é—´ã€å·¥èµ„ï¼Œå…¶ä¸­å‘˜å·¥çš„ç®¡ç†è€…ä¸º â€˜De Haan'

```mysql
SELECT employee_id, last_name, hire_date, salary
FROM employee
WHERE manager_id IN (
	SELECT manager_id
    FROM employee
    WHERE last_name = 'De Haan'
);
```

18. æŸ¥è¯¢å„éƒ¨é—¨ä¸­å·¥èµ„æ¯”æœ¬éƒ¨é—¨å¹³å‡å·¥èµ„é«˜çš„å‘˜å·¥çš„å‘˜å·¥å·ï¼Œå§“åå’Œå·¥èµ„ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰

```mysql
SELECT department_id, last_name, salary
FROM employees e1
WHERE salary > (
	SELECT AVG(salary)
    FROM employees e2
    WHERE e2.`department_id` = e1.`department_id`
);

SELECT e.last_name, e.salary, e.department_id
FROM employees e, (
	SELECT department_id, AVG(salary) avg_sal
    FROM employees
    GROUP BY department_id
) t_dept_avg_sal
WHERE e.`department_id` = t_dept_avg_sal.`department_id`
AND e.`salary` > t_dept_avg_sal.`avg_sal`;
```

19. æŸ¥è¯¢æ¯ä¸ªéƒ¨é—¨ä¸‹çš„éƒ¨é—¨äººæ•°å¤§äº5çš„éƒ¨é—¨åç§°ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰

```mysql
SELECT department_name
FROM departments d
WHERE 5 < (
	SELECT COUNT(*)
    FROM employees e
    WHERE d.`department_id` = e.`department_id`
);
```

20. æŸ¥è¯¢æ¯ä¸ªå›½å®¶ä¸‹çš„éƒ¨é—¨ä¸ªæ•°å¤§äº2çš„å›½å®¶ç¼–å·ï¼ˆç›¸å…³å­æŸ¥è¯¢ï¼‰

```mysql
SELECT country_id
FROM locations l
WHERE 2 < (
	SELECT COUNT(*)
    FROM department d
    WHERE l.`location_id` = d.`location_id`
);
```



# å‚è€ƒèµ„æ–™

- [å°šç¡…è°·-å®‹çº¢åº·è€å¸ˆï¼ŒMySQLæ•°æ®åº“æ•™ç¨‹å¤©èŠ±æ¿ï¼Œmysqlå®‰è£…åˆ°mysqlé«˜çº§ï¼Œå¼ºï¼ç¡¬ï¼](https://www.bilibili.com/video/BV1iq4y1u7vj)