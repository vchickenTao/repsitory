**<span style="font-size: 35px;">ğŸ‰ MySQL åŸºç¡€ç¯‡ -Â å¤šè¡¨æŸ¥è¯¢</span>**

---

# å¤šè¡¨æŸ¥è¯¢

## 1. å¤šè¡¨æŸ¥è¯¢åˆ†ç±»è®²è§£

### 1) è‡ªè¿æ¥

é¢˜ç›®ï¼šæŸ¥è¯¢employeesè¡¨ï¼Œè¿”å› <å‘˜å·¥ works for è€æ¿>

```mysql
SELECT CONCAT(worker.last_name , ' works for ', manager.last_name)
FROM employees worker, employees manager
WHERE worker.manager_id = manager.employee_id;
```

### 2) å†…è¿æ¥ä¸å¤–è¿æ¥

* å†…è¿æ¥: åˆå¹¶å…·æœ‰åŒä¸€åˆ—çš„ä¸¤ä¸ªä»¥ä¸Šçš„è¡¨çš„è¡Œ, ç»“æœé›†ä¸­ä¸åŒ…å«ä¸€ä¸ªè¡¨ä¸å¦ä¸€ä¸ªè¡¨ä¸åŒ¹é…çš„è¡Œ 

**SQL92è¯­æ³•**

```mysql
SELECT emp.employee_id, dep.department_name
FROM employee emp, department dep
WHERE emp.`department_id` = dep.`department_id`;
```

**SQL99è¯­æ³•**

```mysql
SELECT emp.employee_id, dep.department_name
FROM employee emp JOIN department dep
ON emp.`department_id` = dep.`department_id`;
```

* å¤–è¿æ¥: ä¸¤ä¸ªè¡¨åœ¨è¿æ¥è¿‡ç¨‹ä¸­é™¤äº†è¿”å›æ»¡è¶³è¿æ¥æ¡ä»¶çš„è¡Œä»¥å¤–è¿˜è¿”å›å·¦ï¼ˆæˆ–å³ï¼‰è¡¨ä¸­ä¸æ»¡è¶³æ¡ä»¶çš„ è¡Œ ï¼Œè¿™ç§è¿æ¥ç§°ä¸ºå·¦ï¼ˆæˆ–å³ï¼‰ å¤–è¿æ¥ã€‚æ²¡æœ‰åŒ¹é…çš„è¡Œæ—¶, ç»“æœè¡¨ä¸­ç›¸åº”çš„åˆ—ä¸ºç©º(NULL)ã€‚ 
* å¦‚æœæ˜¯å·¦å¤–è¿æ¥ï¼Œåˆ™è¿æ¥æ¡ä»¶ä¸­å·¦è¾¹çš„è¡¨ä¹Ÿç§°ä¸º ä¸»è¡¨ ï¼Œå³è¾¹çš„è¡¨ç§°ä¸º ä»è¡¨ ã€‚ 

**LEFT OUTER JOIN**

```mysql
SELECT last_name, department_name
FROM employees emp LEFT OUTER JOIN department dep
ON emp.`department_id` = dep.`department_id`;
```

* å¦‚æœæ˜¯å³å¤–è¿æ¥ï¼Œåˆ™è¿æ¥æ¡ä»¶ä¸­å³è¾¹çš„è¡¨ä¹Ÿç§°ä¸º ä¸»è¡¨ ï¼Œå·¦è¾¹çš„è¡¨ç§°ä¸º ä»è¡¨ ã€‚

**RIGHT OUTER JOIN**

```mysql
SELECT last_name, department_name
FROM employees emp RIGHT OUTER JOIN department dep
ON emp.`department_id` = dep.`department_id`;
```

## 2. UNIONçš„ä½¿ç”¨

**åˆå¹¶æŸ¥è¯¢ç»“æœ** 

åˆ©ç”¨UNIONå…³é”®å­—ï¼Œå¯ä»¥ç»™å‡ºå¤šæ¡SELECTè¯­å¥ï¼Œå¹¶å°†å®ƒä»¬çš„ç»“æœç»„åˆæˆå•ä¸ªç»“æœé›†ã€‚åˆå¹¶ æ—¶ï¼Œä¸¤ä¸ªè¡¨å¯¹åº”çš„åˆ—æ•°å’Œæ•°æ®ç±»å‹å¿…é¡»ç›¸åŒï¼Œå¹¶ä¸”ç›¸äº’å¯¹åº”ã€‚å„ä¸ªSELECTè¯­å¥ä¹‹é—´ä½¿ç”¨UNIONæˆ–UNION ALLå…³é”®å­—åˆ†éš”ã€‚

è¯­æ³•æ ¼å¼ï¼š

```mysql
SELECT column,... FROM table1
UNION [ALL]
SELECT column,... FROM table2
```

**UNIONæ“ä½œç¬¦**

UNION æ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ï¼Œå»é™¤é‡å¤è®°å½•ã€‚

**UNION ALLæ“ä½œç¬¦**

UNION ALLæ“ä½œç¬¦è¿”å›ä¸¤ä¸ªæŸ¥è¯¢çš„ç»“æœé›†çš„å¹¶é›†ã€‚å¯¹äºä¸¤ä¸ªç»“æœé›†çš„é‡å¤éƒ¨åˆ†ï¼Œä¸å»é‡ã€‚

> æ³¨æ„ï¼šæ‰§è¡ŒUNION ALLè¯­å¥æ—¶æ‰€éœ€è¦çš„èµ„æºæ¯”UNIONè¯­å¥å°‘ã€‚å¦‚æœæ˜ç¡®çŸ¥é“åˆå¹¶æ•°æ®åçš„ç»“æœæ•°æ®ä¸å­˜åœ¨é‡å¤æ•°æ®ï¼Œæˆ–è€…ä¸éœ€è¦å»é™¤é‡å¤çš„æ•°æ®ï¼Œåˆ™å°½é‡ä½¿ç”¨UNION ALLè¯­å¥ï¼Œä»¥æé«˜æ•°æ®æŸ¥è¯¢çš„æ•ˆç‡ã€‚

ä¸¾ä¾‹ï¼šæŸ¥è¯¢éƒ¨é—¨ç¼–å·>90æˆ–é‚®ç®±åŒ…å«açš„å‘˜å·¥ä¿¡æ¯

```mysql
#æ–¹å¼1
SELECT * FROM employees WHERE email LIKE '%a%' OR department_id>90;
```

```mysql
#æ–¹å¼2
SELECT * FROM employees WHERE email LIKE '%a%'
UNION
SELECT * FROM employees WHERE department_id>90;
```

ä¸¾ä¾‹ï¼šæŸ¥è¯¢ä¸­å›½ç”¨æˆ·ä¸­ç”·æ€§çš„ä¿¡æ¯ä»¥åŠç¾å›½ç”¨æˆ·ä¸­å¹´ç”·æ€§çš„ç”¨æˆ·ä¿¡æ¯

```mysql
SELECT id,cname FROM t_chinamale WHERE csex='ç”·'
UNION ALL
SELECT id,tname FROM t_usmale WHERE tGender='male';
```

## 3.ä¸ƒç§SQL JOINSçš„å®ç°

<img src="D:/idea/repsitory/database/MySQL/MySQLåŸºç¡€ç¯‡.assets/image-20220531224324213.png" alt="image-20220531224324213" style="zoom:80%;" />

```mysql
# ä¸­å›¾ï¼šå†…è¿æ¥
SELECT employee_id,department_name
FROM employees e JOIN departments d
ON e.`department_id` = d.`department_id`;

# å·¦ä¸Šå›¾ï¼šå·¦å¤–è¿æ¥
SELECT employee_id,department_name
FROM employees e LEFT JOIN departments d
ON e.`department_id` = d.`department_id`;

# å³ä¸Šå›¾ï¼šå³å¤–è¿æ¥
SELECT employee_id,department_name
FROM employees e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`;

# å·¦ä¸­å›¾ï¼š
SELECT employee_id,department_name
FROM employees e LEFT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE d.`department_id` IS NULL;

# å³ä¸­å›¾ï¼š
SELECT employee_id,department_name
FROM employees e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE e.`department_id` IS NULL;


# å·¦ä¸‹å›¾ï¼šæ»¡å¤–è¿æ¥
# æ–¹å¼1ï¼šå·¦ä¸Šå›¾ UNION ALL å³ä¸­å›¾
SELECT employee_id,department_name
FROM employees e LEFT JOIN departments d
ON e.`department_id` = d.`department_id`
UNION ALL
SELECT employee_id,department_name
FROM employees e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE e.`department_id` IS NULL;


# æ–¹å¼2ï¼šå·¦ä¸­å›¾ UNION ALL å³ä¸Šå›¾
SELECT employee_id,department_name
FROM employees e LEFT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE d.`department_id` IS NULL
UNION ALL
SELECT employee_id,department_name
FROM employees e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`;

# å³ä¸‹å›¾ï¼šå·¦ä¸­å›¾  UNION ALL å³ä¸­å›¾
SELECT employee_id,department_name
FROM employees e LEFT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE d.`department_id` IS NULL
UNION ALL
SELECT employee_id,department_name
FROM employees e RIGHT JOIN departments d
ON e.`department_id` = d.`department_id`
WHERE e.`department_id` IS NULL;
```

## 4. SQL99è¯­æ³•çš„æ–°ç‰¹æ€§

### 1) è‡ªç„¶è¿æ¥

SQL99 åœ¨ SQL92 çš„åŸºç¡€ä¸Šæä¾›äº†ä¸€äº›ç‰¹æ®Šè¯­æ³•ï¼Œæ¯”å¦‚ NATURAL JOIN ç”¨æ¥è¡¨ç¤ºè‡ªç„¶è¿æ¥ã€‚æˆ‘ä»¬å¯ä»¥æŠŠ è‡ªç„¶è¿æ¥ç†è§£ä¸º SQL92 ä¸­çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¼šå¸®ä½ è‡ªåŠ¨æŸ¥è¯¢ä¸¤å¼ è¿æ¥è¡¨ä¸­ æ‰€æœ‰ç›¸åŒçš„å­—æ®µ ï¼Œç„¶åè¿›è¡Œ ç­‰å€¼ è¿æ¥ ã€‚

åœ¨SQL92æ ‡å‡†ä¸­ï¼š

```mysql
SELECT employee_id,last_name,department_name
FROM employees e JOIN departments d
ON e.`department_id` = d.`department_id`
AND e.`manager_id` = d.`manager_id`;
```

åœ¨ SQL99 ä¸­ä½ å¯ä»¥å†™æˆï¼š

```mysql
SELECT employee_id,last_name,department_name
FROM employees e NATURAL JOIN departments d;
```

### 2) USINGè¿æ¥

å½“æˆ‘ä»¬è¿›è¡Œè¿æ¥çš„æ—¶å€™ï¼ŒSQL99è¿˜æ”¯æŒä½¿ç”¨ USING æŒ‡å®šæ•°æ®è¡¨é‡Œçš„ åŒåå­—æ®µ è¿›è¡Œç­‰å€¼è¿æ¥ã€‚ä½†æ˜¯åªèƒ½é… åˆJOINä¸€èµ·ä½¿ç”¨ã€‚æ¯”å¦‚ï¼š

```mysql
SELECT employee_id,last_name,department_name
FROM employees e JOIN departments d
USING (department_id);
```

ä½ èƒ½çœ‹å‡ºä¸è‡ªç„¶è¿æ¥ NATURAL JOIN ä¸åŒçš„æ˜¯ï¼ŒUSING æŒ‡å®šäº†å…·ä½“çš„ç›¸åŒçš„å­—æ®µåç§°ï¼Œä½ éœ€è¦åœ¨ USING çš„æ‹¬å· () ä¸­å¡«å…¥è¦æŒ‡å®šçš„åŒåå­—æ®µã€‚åŒæ—¶ä½¿ç”¨ JOIN...USING å¯ä»¥ç®€åŒ– JOIN ON çš„ç­‰å€¼è¿æ¥ã€‚å®ƒä¸ä¸‹ é¢çš„ SQL æŸ¥è¯¢ç»“æœæ˜¯ç›¸åŒçš„ï¼š

```mysql
SELECT employee_id,last_name,department_name
FROM employees e ,departments d
WHERE e.department_id = d.department_id;
```

## 5. å°ç»“

è¡¨è¿æ¥çš„çº¦æŸæ¡ä»¶å¯ä»¥æœ‰ä¸‰ç§æ–¹å¼ï¼šWHERE, ON, USING 

* WHEREï¼šé€‚ç”¨äºæ‰€æœ‰å…³è”æŸ¥è¯¢ 
* ON ï¼šåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨ï¼Œåªèƒ½å†™å…³è”æ¡ä»¶ã€‚è™½ç„¶å…³è”æ¡ä»¶å¯ä»¥å¹¶åˆ°WHEREä¸­å’Œå…¶ä»–æ¡ä»¶ä¸€èµ· å†™ï¼Œä½†åˆ†å¼€å†™å¯è¯»æ€§æ›´å¥½ã€‚ 
* USINGï¼šåªèƒ½å’ŒJOINä¸€èµ·ä½¿ç”¨ï¼Œè€Œä¸”è¦æ±‚ä¸¤ä¸ªå…³è”å­—æ®µåœ¨å…³è”è¡¨ä¸­åç§°ä¸€è‡´ï¼Œè€Œä¸”åªèƒ½è¡¨ç¤ºå…³è”å­— æ®µå€¼ç›¸ç­‰

> æˆ‘ä»¬è¦æ§åˆ¶è¿æ¥è¡¨çš„æ•°é‡ ã€‚
>
> å¤šè¡¨è¿æ¥å°±ç›¸å½“äºåµŒå¥— for å¾ªç¯ä¸€æ ·ï¼Œéå¸¸æ¶ˆè€—èµ„æºï¼Œä¼šè®© SQL æŸ¥è¯¢æ€§èƒ½ä¸‹ é™å¾—å¾ˆä¸¥é‡ï¼Œå› æ­¤ä¸è¦è¿æ¥ä¸å¿…è¦çš„è¡¨ã€‚
>
> åœ¨è®¸å¤š DBMS ä¸­ï¼Œä¹Ÿéƒ½ä¼šæœ‰æœ€å¤§è¿æ¥è¡¨çš„é™åˆ¶ã€‚

```mysql
# ä¹ é¢˜å·©å›º
# æ³¨æ„ï¼šå½“ä¸¤ä¸ªè¡¨å¤–è¿æ¥ä¹‹åï¼Œç»„æˆä¸»è¡¨å’Œä»è¡¨ï¼Œä¸»è¡¨çš„è¿æ¥å­—æ®µæ˜¯ä¸ä¸ºç©ºçš„ï¼Œä»è¡¨çš„è¿æ¥å­—æ®µå¯èƒ½ä¸ºç©ºï¼Œå› æ­¤ä»è¡¨çš„å…³é”®å­—æ®µç”¨æ¥åˆ¤æ–­æ˜¯å¦ä¸ºç©ºã€‚

# 1.æŸ¥è¯¢å“ªäº›éƒ¨é—¨æ²¡æœ‰å‘˜å·¥
# æ–¹å¼ä¸€
SELECT d.department_id
FROM departments d LEFT JOIN employees e
ON d.`department_id` = e.`department_id`
WHERE e.`department_id` IS NULL;

# æ–¹å¼äºŒ
SELECT department_id
FROM departments d
WHERE NOT EXISTS (
		SELECT *
    	FROM employees e
    	WHERE e.`department_id` = d.`department_id`
);

# 2.æŸ¥è¯¢å“ªä¸ªåŸå¸‚æ²¡æœ‰éƒ¨é—¨
SELECT l.location_id, l.city
FROM locations l LEFT JOIN departments d
ON l.`location_id` = d.`location_id`
WHERE d.`location_id` IS NULL;

# 3.æŸ¥è¯¢éƒ¨é—¨åä¸º Sales æˆ– IT çš„å‘˜å·¥ä¿¡æ¯
SELECT e.employee_id, e.last_name, e.department_id
FROM employees e JOIN department d
ON e.`department_id` = d.`department_id`
WHERE d.`department_name` IN ('Sales', 'IT');
```

# å‚è€ƒèµ„æ–™

- [å°šç¡…è°·-å®‹çº¢åº·è€å¸ˆï¼ŒMySQLæ•°æ®åº“æ•™ç¨‹å¤©èŠ±æ¿ï¼Œmysqlå®‰è£…åˆ°mysqlé«˜çº§ï¼Œå¼ºï¼ç¡¬ï¼](https://www.bilibili.com/video/BV1iq4y1u7vj)