# ğŸ˜¸ JavaåŸºç¡€ - åå°„è¯¦è§£

---

# ä½•ä¸ºåå°„ï¼Ÿ

`åå°„(Reflection)`ï¼Œæ˜¯æŒ‡Javaç¨‹åºå…·æœ‰ **åœ¨è¿è¡ŒæœŸ** åˆ†æç±»ä»¥åŠä¿®æ”¹å…¶æœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„èƒ½åŠ› ã€‚

é€šä¿—ç‚¹è¯´,å°±æ˜¯é€šè¿‡åå°„æˆ‘ä»¬å¯ä»¥ **åŠ¨æ€åœ°** è·å–ä¸€ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œè¿˜å¯ä»¥æ“ä½œè¿™äº›æ–¹æ³•å’Œå±æ€§ã€‚

# å®ä¾‹çš„åˆ›å»º

ä¸€èˆ¬æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå¯¹è±¡å®ä¾‹ **Person zhang = new Person()**;

è™½ç„¶æ˜¯ç®€ç®€å•å•ä¸€å¥ï¼Œä½†JVMå†…éƒ¨çš„å®ç°è¿‡ç¨‹æ˜¯å¤æ‚çš„ï¼š

1. å°†ç¡¬ç›˜ä¸ŠæŒ‡å®šä½ç½®çš„Person.classæ–‡ä»¶åŠ è½½è¿›å†…å­˜ï¼›
2. æ‰§è¡Œmainæ–¹æ³•æ—¶ï¼Œåœ¨**æ ˆå†…å­˜**ä¸­å¼€è¾Ÿäº†mainæ–¹æ³•çš„ç©ºé—´ï¼ˆå‹æ ˆ-è¿›æ ˆï¼‰ï¼Œç„¶ååœ¨mainæ–¹æ³•çš„æ ˆåŒºåˆ†é…äº†ä¸€ä¸ªå˜é‡zhangï¼›
3. æ‰§è¡Œnewï¼Œåœ¨å †å†…å­˜ä¸­å¼€è¾Ÿä¸€ä¸ª å®ä½“ç±»çš„ ç©ºé—´ï¼Œåˆ†é…äº†ä¸€ä¸ª**å†…å­˜é¦–åœ°å€å€¼**ï¼›
4. è°ƒç”¨è¯¥å®ä½“ç±»å¯¹åº”çš„æ„é€ å‡½æ•°ï¼Œè¿›è¡Œåˆå§‹åŒ–ï¼ˆå¦‚æœæ²¡æœ‰æ„é€ å‡½æ•°ï¼ŒJavaä¼šè¡¥ä¸Šä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°ï¼‰ï¼›
5. å°†å®ä½“ç±»çš„ é¦–åœ°å€èµ‹å€¼ç»™zhangï¼Œå˜é‡zhangå°±å¼•ç”¨äº†è¯¥å®ä½“ã€‚ï¼ˆæŒ‡å‘äº†è¯¥å¯¹è±¡ï¼‰ã€‚

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/df824941-9d7b-43d8-89f0-e2b0bc2f71a7_reflect01.png)

å…¶ä¸­ä¸Šå›¾æ­¥éª¤1 Classloader(ç±»åŠ è½½å™¨) å°†classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­å…·ä½“åˆ†ä¸º3ä¸ªé˜¶æ®µï¼š`åŠ è½½`ã€`è¿æ¥`ã€`åˆå§‹åŒ–`

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/a1f4af39-9adf-4192-858f-55749ee269b4_reflect02.png)

è€Œåˆåœ¨ **åŠ è½½é˜¶æ®µï¼Œç±»åŠ è½½å™¨** ä¼š å°†ç±»å¯¹åº”çš„.classæ–‡ä»¶ä¸­çš„äºŒè¿›åˆ¶å­—èŠ‚æµè¯»å…¥åˆ°å†…å­˜ä¸­ï¼Œå°†è¿™ä¸ªå­—èŠ‚æµè½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œç„¶ååœ¨å †åŒºåˆ›å»ºä¸€ä¸ª**java.lang.Class å¯¹è±¡**ï¼ˆç±»ç›¸å…³çš„ä¿¡æ¯ï¼‰ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£

?> å…³äºç±»åŠ è½½çš„è¿‡ç¨‹ï¼Œè¯¦æƒ…å¯ä»¥é˜…è¯»è¿™ç¯‡æ–‡ç« [JVM åŸºç¡€ Javaç±»åŠ è½½æœºåˆ¶](/java/JVM/Javaç±»åŠ è½½æœºåˆ¶)ã€‚

ç„¶åå†é€šè¿‡ **ç±»çš„å®ä¾‹** æ¥æ‰§æ“ä½œ **ç±»çš„æ–¹æ³•å’Œå±æ€§** ï¼Œæ¯”å¦‚ zhang.eat(), zhang.getHeight() ç­‰ç­‰

å¦‚æœæˆ‘ä»¬ä½¿ç”¨åå°„çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦æ‹¿åˆ°è¯¥ç±»Personçš„Classå¯¹è±¡ï¼Œå†é€šè¿‡Classå¯¹è±¡æ¥æ“ä½œ **ç±»çš„æ–¹æ³•å’Œå±æ€§æˆ–è€…åˆ›å»ºç±»çš„å®ä¾‹**

```java
Class personClass = Person.class;//è¿™è¾¹åªæ˜¯ä¸¾ä¸€ä¸ªä¾‹å­ï¼Œè·å–classå¯¹è±¡çš„å¤šç§æ–¹å¼ï¼Œæœ¬æ–‡åé¢å†æ…¢æ…¢é“æ¥
Object person = personClass.newInstance();
```

æˆ‘ä»¬å¯ä»¥å‘ç° é€šè¿‡newåˆ›å»ºç±»çš„å®ä¾‹å’Œåå°„åˆ›å»ºç±»çš„å®ä¾‹ï¼Œéƒ½ç»•ä¸å¼€`.classæ–‡ä»¶` å’Œ `Classç±»`çš„ã€‚

## .classæ–‡ä»¶

é¦–å…ˆæˆ‘ä»¬å¾—å…ˆäº†è§£ä¸€ä¸‹ ä»€ä¹ˆæ˜¯.classæ–‡ä»¶

ä¸¾ä¸ªç®€å•çš„ä¾‹å­ï¼Œåˆ›å»ºä¸€ä¸ªPersonç±»ï¼š

```java
public class Person {
    /**
     * çŠ¶æ€ or å±æ€§
     */
    String name;//å§“å
    String sex;//æ€§åˆ«
    int height;//èº«é«˜
    int weight;//ä½“é‡
    
    /**
     * è¡Œä¸º
     */
    public void sleep(){
    	System.out.println(this.name+"--"+ "ç¡è§‰");
	}
    public void eat(){
        System.out.println("åƒé¥­");
    }
    public void Dance(){
        System.out.println("è·³èˆ");
    }
}
```

æˆ‘ä»¬æ‰§è¡Œjavacå‘½ä»¤ï¼Œç¼–è¯‘ç”ŸæˆPerson.classæ–‡ä»¶

ç„¶åæˆ‘ä»¬é€šè¿‡vim 16è¿›åˆ¶ æ‰“å¼€å®ƒ

```java
#æ‰“å¼€fileæ–‡ä»¶
vim Person.class 

#åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥.. ä»¥16è¿›åˆ¶æ˜¾ç¤º
 :%!xxd
 
#åœ¨å‘½ä»¤æ¨¡å¼ä¸‹è¾“å…¥.. åˆ‡æ¢å›é»˜è®¤æ˜¾ç¤º
:%!xxd -r
```

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/5fd6793f-4cbc-4c30-89d1-dfa8ccb521d2_reflect03.png)

ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œä¸åŒçš„ CPU å…·æœ‰ä¸åŒçš„æŒ‡ä»¤é›†ï¼ŒJAVAèƒ½åšåˆ°å¹³å°æ— å…³æ€§ï¼Œä¾é çš„å°±æ˜¯ Java è™šæ‹Ÿæœºã€‚

.javaæºç æ˜¯ç»™äººç±»è¯»çš„ï¼Œè€Œ **.classå­—èŠ‚ç æ˜¯ç»™JVMè™šæ‹Ÿæœºè¯»çš„** ï¼Œè®¡ç®—æœºæ™ºèƒ½è¯†åˆ« 0 å’Œ 1ç»„æˆçš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œæ‰€ä»¥è™šæ‹Ÿæœºå°±æ˜¯æˆ‘ä»¬ç¼–å†™çš„ä»£ç å’Œè®¡ç®—æœºä¹‹é—´çš„æ¡¥æ¢ã€‚

è™šæ‹Ÿæœºå°†æˆ‘ä»¬ç¼–å†™çš„ .java æºç¨‹åºæ–‡ä»¶ç¼–è¯‘ä¸º å­—èŠ‚ç  æ ¼å¼çš„ .class æ–‡ä»¶ï¼Œå­—èŠ‚ç æ˜¯å„ç§è™šæ‹Ÿæœºä¸æ‰€æœ‰å¹³å°ç»Ÿä¸€ä½¿ç”¨çš„ç¨‹åºå­˜å‚¨æ ¼å¼ï¼Œclassæ–‡ä»¶ä¸»è¦ç”¨äºè§£å†³å¹³å°æ— å…³æ€§çš„ä¸­é—´æ–‡ä»¶

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/a3f69367-dcd7-4ef8-8c91-73db16e0fe5a_reflect04.png)

Person.classæ–‡ä»¶ åŒ…å«Personç±»çš„æ‰€æœ‰ä¿¡æ¯

?> æƒ³è¦æ·±å…¥äº†è§£.classæ–‡ä»¶ï¼Œå¯ä»¥é˜…è¯»[JVM åŸºç¡€ ç±»å­—èŠ‚ç è¯¦è§£](java/JVM/ç±»å­—èŠ‚ç è¯¦è§£)ä¸€æ–‡ã€‚



## Classç±»

æˆ‘ä»¬æ¥çœ‹ä¸‹jdkçš„å®˜æ–¹apiæ–‡æ¡£å¯¹å…¶çš„å®šä¹‰ï¼š

Classç±»çš„ç±»è¡¨ç¤ºæ­£åœ¨è¿è¡Œçš„Javaåº”ç”¨ç¨‹åºä¸­çš„`ç±»`å’Œ`æ¥å£`ã€‚ 

æšä¸¾æ˜¯ä¸€ç§ç±»ï¼Œä¸€ä¸ªæ³¨é‡Šæ˜¯ä¸€ç§ç•Œé¢ã€‚ 

æ¯ä¸ªæ•°ç»„ä¹Ÿå±äºä¸€ä¸ªåæ˜ ä¸ºç±»å¯¹è±¡çš„ç±»ï¼Œè¯¥å¯¹è±¡ç”±å…·æœ‰ç›¸åŒå…ƒç´ ç±»å‹å’Œç»´æ•°çš„æ‰€æœ‰æ•°ç»„å…±äº«ã€‚

åŸå§‹Javaç±»å‹ï¼ˆ `boolean ï¼Œ byte ï¼Œ char ï¼Œ short ï¼Œ int ï¼Œ long ï¼Œ floatå’Œdouble` ï¼‰ï¼Œå’Œ`å…³é”®å­—void`ä¹Ÿè¡¨ç¤ºä¸º`ç±»å¯¹è±¡`ã€‚

ç±»æ²¡æœ‰å…¬å…±æ„é€ å‡½æ•°ã€‚ ç›¸åï¼Œ ç±»å¯¹è±¡ç”±Javaè™šæ‹Ÿæœºè‡ªåŠ¨æ„å»ºï¼Œå› ä¸ºåŠ è½½äº†ç±»ï¼Œå¹¶ä¸”é€šè¿‡è°ƒç”¨ç±»åŠ è½½å™¨ä¸­çš„defineClassæ–¹æ³•ã€‚ã€‚

**java ä¸‡ç‰©çš†æ˜¯Classç±»**



æˆ‘ä»¬æ¥çœ‹ä¸‹Classç±»çš„æºç ï¼Œæºç å¤ªå¤šäº†ï¼ŒæŒ‘äº†å‡ ä¸ªé‡ç‚¹ï¼š

```java
public final class Class<T> implements java.io.Serializable,
                              GenericDeclaration,
                              Type,
                              AnnotatedElement {
    private static final int ANNOTATION= 0x00002000;
    private static final int ENUM      = 0x00004000;
    private static final int SYNTHETIC = 0x00001000;

    private static native void registerNatives();
    static {
        registerNatives();
    }

    /*
     * Private constructor. Only the Java Virtual Machine creates Class objects.
     * This constructor is not used and prevents the default constructor being
     * generated.
     */
    private Class(ClassLoader loader) { //ç§æœ‰åŒ–çš„ æ„é€ å™¨
        // Initialize final field for classLoader.  The initialization value of non-null
        // prevents future JIT optimizations from assuming this final field is null.
        classLoader = loader;
    }
    ...
    
    // reflection data that might get invalidated when JVM TI RedefineClasses() is called
    private static class ReflectionData<T> {
        volatile Field[] declaredFields;//å­—æ®µ
        volatile Field[] publicFields;
        volatile Method[] declaredMethods;//æ–¹æ³•
        volatile Method[] publicMethods;
        volatile Constructor<T>[] declaredConstructors;//æ„é€ å™¨
        volatile Constructor<T>[] publicConstructors;
        // Intermediate results for getFields and getMethods
        volatile Field[] declaredPublicFields;
        volatile Method[] declaredPublicMethods;
        volatile Class<?>[] interfaces;//æ¥å£

        // Value of classRedefinedCount when we created this ReflectionData instance
        final int redefinedCount;

        ReflectionData(int redefinedCount) {
            this.redefinedCount = redefinedCount;
        }
    }
      ...
     //æ³¨é‡Šæ•°æ®
     private volatile transient AnnotationData annotationData;

    private AnnotationData annotationData() {
        while (true) { // retry loop
            AnnotationData annotationData = this.annotationData;
            int classRedefinedCount = this.classRedefinedCount;
            if (annotationData != null &&
                annotationData.redefinedCount == classRedefinedCount) {
                return annotationData;
            }
            // null or stale annotationData -> optimistically create new instance
            AnnotationData newAnnotationData = createAnnotationData(classRedefinedCount);
            // try to install it
            if (Atomic.casAnnotationData(this, annotationData, newAnnotationData)) {
                // successfully installed new AnnotationData
                return newAnnotationData;
            }
        }
    } 
    ...
```

æˆ‘ä»¬å¯ä»¥å‘ç°Classä¹Ÿæ˜¯ç±»ï¼Œæ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»ï¼Œå°†æˆ‘ä»¬å®šä¹‰æ™®é€šç±»çš„å…±åŒçš„éƒ¨åˆ†è¿›è¡ŒæŠ½è±¡ï¼Œä¿å­˜`ç±»çš„å±æ€§`ï¼Œ`æ–¹æ³•`ï¼Œ`æ„é€ æ–¹æ³•`ï¼Œ`ç±»å`ã€`åŒ…å`ã€`çˆ¶ç±»`ï¼Œ`æ³¨è§£`ç­‰å’Œç±»ç›¸å…³çš„ä¿¡æ¯ã€‚

Classç±»çš„æ„é€ æ–¹æ³•æ˜¯privateï¼Œ **åªæœ‰JVMèƒ½åˆ›å»ºClasså®ä¾‹** ï¼Œæˆ‘ä»¬å¼€å‘äººå‘˜ æ˜¯æ— æ³•åˆ›å»ºClasså®ä¾‹çš„ï¼ŒJVMåœ¨æ„é€ Classå¯¹è±¡æ—¶ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ª **ç±»åŠ è½½å™¨** ã€‚

ç±»ä¹Ÿæ˜¯å¯ä»¥ç”¨æ¥å­˜å‚¨æ•°æ®çš„ï¼ŒClassç±»å°±åƒ æ™®é€šç±»çš„æ¨¡æ¿ ä¸€æ ·ï¼Œç”¨æ¥ä¿å­˜â€œç±»æ‰€æœ‰ç›¸å…³ä¿¡æ¯â€çš„ç±»ã€‚

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/0afe03b2-8cda-41bd-8bdf-24cc3e14045f_reflect05.png)



æˆ‘ä»¬æ¥ç»§ç»­çœ‹è¿™ä¸ªåˆ©ç”¨åå°„çš„ä¾‹å­ï¼š Class personClass = Person.class;

ç”±äºJVMä¸ºåŠ è½½çš„ Person.classåˆ›å»ºäº†å¯¹åº”çš„Classå®ä¾‹ï¼Œå¹¶åœ¨è¯¥å®ä¾‹ä¸­ä¿å­˜äº†è¯¥ Person.classçš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤ï¼Œå¦‚æœè·å–äº†Classå®ä¾‹ï¼ˆpersonClass ï¼‰ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªClasså®ä¾‹è·å–åˆ°è¯¥å®ä¾‹å¯¹åº”çš„ **Personç±»** çš„æ‰€æœ‰ä¿¡æ¯ã€‚

# åå°„çš„ä½¿ç”¨

## è·å–Classå®ä¾‹4ç§æ–¹å¼

### 1.é€šè¿‡å¯¹è±¡è°ƒç”¨ getClass() æ–¹æ³•æ¥è·å–

```java
Person p1 = new Person();
Class c1 = p1.getClass();
```

åƒè¿™ç§å·²ç»åˆ›å»ºäº†å¯¹è±¡çš„ï¼Œå†å»è¿›è¡Œåå°„çš„è¯ï¼Œæœ‰ç‚¹å¤šæ­¤ä¸€ä¸¾ã€‚

ä¸€èˆ¬æ˜¯ç”¨äºä¼ è¿‡æ¥çš„æ˜¯Objectç±»å‹çš„å¯¹è±¡ï¼Œä¸çŸ¥é“å…·ä½“æ˜¯ä»€ä¹ˆç±»ï¼Œå†ç”¨è¿™ç§æ–¹å¼æ¯”è¾ƒé è°±

### 2.ç±»å.class

```java
Class c2 = Person.class;
```

è¿™ç§éœ€è¦æå‰çŸ¥é“å¯¼å…¥ç±»çš„åŒ…ï¼Œç¨‹åºæ€§èƒ½æ›´é«˜ï¼Œæ¯”è¾ƒå¸¸ç”¨ï¼Œé€šè¿‡æ­¤æ–¹å¼è·å– Class å¯¹è±¡ **ï¼ŒPersonç±»ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–**

### 3.é€šè¿‡ Class å¯¹è±¡çš„ forName() é™æ€æ–¹æ³•æ¥è·å–ï¼Œæœ€å¸¸ç”¨çš„ä¸€ç§æ–¹å¼

```java
Class c3 = Class.forName("com.zj.demotest.domain.Person");
```

è¿™ç§åªéœ€ä¼ å…¥ç±»çš„å…¨è·¯å¾„ **ï¼Œ** Class.forNameä¼šè¿›è¡Œåˆå§‹åŒ–initializationæ­¥éª¤ **ï¼Œå³é™æ€åˆå§‹åŒ–ï¼ˆä¼šåˆå§‹åŒ–ç±»å˜é‡ï¼Œé™æ€ä»£ç å—ï¼‰ã€‚**

### 4.é€šè¿‡ç±»åŠ è½½å™¨å¯¹è±¡çš„ loadClass() æ–¹æ³•

```java
public class TestReflection {
    public static void main(String[] args) throws ClassNotFoundException {
        Person p1 = new Person();
        Class c1 = p1.getClass();

        Class c2 = Person.class;

        Class c3 = Class.forName("com.zj.demotest.domain.Person");

        //ç¬¬4ä¸­æ–¹å¼ï¼Œç±»åŠ è½½å™¨
        ClassLoader classLoader = TestReflection.class.getClassLoader();
        Class c4 = classLoader.loadClass("com.zj.demotest.domain.Person");


        System.out.println(c1.equals(c2));
        System.out.println(c2.equals(c3));
        System.out.println(c3.equals(c4));
        System.out.println(c1.equals(c4));
    }
}
```

loadClassçš„æºç ï¼š

```java
public Class<?> loadClass(String name) throws ClassNotFoundException {
    return loadClass(name, false);
}
```

loadClass ä¼ å…¥çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯"false",å› æ­¤å®ƒä¸ä¼šå¯¹ç±»è¿›è¡Œè¿æ¥è¿™ä¸€æ­¥éª¤ï¼Œæ ¹æ® **ç±»çš„ç”Ÿå‘½å‘¨æœŸ** æˆ‘ä»¬çŸ¥é“ï¼Œå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰è¿›è¡ŒéªŒè¯å’Œå‡†å¤‡çš„è¯ï¼Œæ˜¯æ— æ³•è¿›è¡Œåˆå§‹åŒ–è¿‡ç¨‹çš„ï¼Œå³ ä¸ä¼šè¿›è¡Œç±»åˆå§‹åŒ–ï¼Œé™æ€ä»£ç å—å’Œé™æ€å¯¹è±¡ä¹Ÿä¸ä¼šå¾—åˆ°æ‰§è¡Œ

æˆ‘ä»¬å°†c1,c2,c3,c4è¿›è¡Œ equals æ¯”è¾ƒ

```java
System.out.println(c1.equals(c2));
System.out.println(c2.equals(c3));
System.out.println(c3.equals(c4));
System.out.println(c1.equals(c4));
```

è¿è¡Œç»“æœï¼š

```java
true  true  true  true
```

å› ä¸ºClasså®ä¾‹åœ¨JVMä¸­æ˜¯å”¯ä¸€çš„ï¼Œæ‰€ä»¥ï¼Œä¸Šè¿°æ–¹æ³•è·å–çš„Classå®ä¾‹æ˜¯åŒä¸€ä¸ªå®ä¾‹ï¼Œ **ä¸€ä¸ªç±»åœ¨ JVM ä¸­åªä¼šæœ‰ä¸€ä¸ª Class å®ä¾‹**

## Classç±»å¸¸ç”¨çš„API

æ—¥å¸¸å¼€å‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨åå°„æ˜¯ä¸ºäº† åˆ›å»ºç±»å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰ã€åå°„è·å–ç±»çš„å±æ€§å’Œè°ƒç”¨ç±»çš„æ–¹æ³•

| **getName()**                                  | **è·å¾—ç±»çš„å®Œæ•´åå­—**                                         |
| ---------------------------------------------- | ------------------------------------------------------------ |
| getFields()                                    | è·å¾—ç±»çš„publicç±»å‹çš„å±æ€§                                     |
| getDeclaredFields()                            | è·å¾—ç±»çš„æ‰€æœ‰å±æ€§ã€‚åŒ…æ‹¬ **private å£°æ˜çš„å’Œç»§æ‰¿ç±»**            |
| getMethods()                                   | è·å¾—ç±»çš„publicç±»å‹çš„æ–¹æ³•                                     |
| getDeclaredMethods()                           | è·å¾—ç±»çš„æ‰€æœ‰æ–¹æ³•ã€‚åŒ…æ‹¬ **private å£°æ˜çš„å’Œç»§æ‰¿ç±»**            |
| getMethod(String name, Class[] parameterTypes) | è·å¾—ç±»çš„ç‰¹å®šæ–¹æ³•ï¼Œnameå‚æ•°æŒ‡å®šæ–¹æ³•çš„åå­—ï¼ŒparameterTypes å‚æ•°æŒ‡å®šæ–¹æ³•çš„å‚æ•°ç±»å‹ã€‚ |
| getConstructors()                              | è·å¾—ç±»çš„publicç±»å‹çš„æ„é€ æ–¹æ³•                                 |
| getConstructor(Class[] parameterTypes)         | è·å¾—ç±»çš„ç‰¹å®šæ„é€ æ–¹æ³•ï¼ŒparameterTypes å‚æ•°æŒ‡å®šæ„é€ æ–¹æ³•çš„å‚æ•°ç±»å‹ |
| newInstance()                                  | é€šè¿‡ç±»çš„ä¸å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•åˆ›å»ºè¿™ä¸ªç±»çš„ä¸€ä¸ªå¯¹è±¡               |
| getSuperClass()                                | ç”¨äºè¿”å›è¡¨ç¤ºè¯¥ Class è¡¨ç¤ºçš„ä»»ä½•ç±»ã€æ¥å£ã€åŸå§‹ç±»å‹æˆ–ä»»ä½• void ç±»å‹çš„ **è¶…ç±»çš„Class(å³çˆ¶ç±»)** ã€‚ |
| ...                                            | ...                                                          |

æˆ‘ä»¬è¿™è¾¹å°±ä¸å…¨éƒ¨å±•å¼€è®²äº†ï¼ŒæŒ‘å‡ ä¸ªé‡ç‚¹è®²è§£ä¸€ä¸‹

## åˆ›å»ºå¯¹è±¡

### 1.è°ƒç”¨classå¯¹è±¡çš„ newInstance() æ–¹æ³•

```java
Class c1 = Class.forName("com.zj.demotest.domain.Person");
Person p1 = (Person) c1.newInstance();
p1.eat();
```

ç»“æœï¼š

```java
åƒé¥­
```

æ³¨æ„ï¼šPersonç±»å¿…é¡»æœ‰ä¸€ä¸ª **æ— å‚çš„æ„é€ å™¨** ä¸” **ç±»çš„æ„é€ å™¨çš„è®¿é—®æƒé™ä¸èƒ½æ˜¯private**

### 2.ä½¿ç”¨æŒ‡å®šæ„é€ æ–¹æ³• Constructor æ¥åˆ›å»ºå¯¹è±¡

å¦‚æœæˆ‘ä»¬éå¾—è®©Personç±»çš„æ— å‚æ„é€ å™¨è®¾ä¸ºprivateå‘¢ï¼Œæˆ‘ä»¬å¯ä»¥è·å–å¯¹åº”çš„Constructoræ¥åˆ›å»ºå¯¹è±¡

```java
Class c1 = Class.forName("com.zj.demotest.domain.Person");
Constructor<Person> con =  c1.getDeclaredConstructor();
con.setAccessible(true);//å…è®¸è®¿é—®
Person p1 = con.newInstance();
p1.eat();
```

ç»“æœï¼š

```java
åƒé¥­
```

æ³¨æ„ï¼šsetAccessible()æ–¹æ³•èƒ½åœ¨è¿è¡Œæ—¶ **å‹åˆ¶** Javaè¯­è¨€è®¿é—®æ§åˆ¶æ£€æŸ¥(Java language access control checks)ï¼Œä»è€Œèƒ½ä»»æ„è°ƒç”¨ **è¢«ç§æœ‰åŒ–** ä¿æŠ¤çš„æ–¹æ³•ã€åŸŸå’Œæ„é€ æ–¹æ³•ã€‚

ç”±æ­¤æˆ‘ä»¬å¯ä»¥å‘ç°**å•ä¾‹æ¨¡å¼ä¸å†å®‰å…¨ï¼Œåå°„å¯ç ´ä¹‹ï¼** å½“ç„¶ï¼Œè¿™åªæ˜¯é’ˆå¯¹è¿™ä¸ªåœºæ™¯çš„è¯´æ³•ï¼Œå•ä¾‹æ¨¡å¼æƒ³ä¸è¢«åå°„ç ´åï¼Œä¹Ÿå¯ä»¥æœ‰å…¶ä»–åŠæ³•ï¼Œå¯ä»¥é˜…è¯»[åˆ›å»ºå‹æ¨¡å¼-å•ä¾‹æ¨¡å¼](design/è®¾è®¡æ¨¡å¼/å•ä¾‹æ¨¡å¼)ã€‚

## è®¿é—®å±æ€§

| **Field getField(name)**     | **æ ¹æ®å­—æ®µåè·å–æŸä¸ªpublicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰** |
| ---------------------------- | ----------------------------------------------- |
| Field getDeclaredField(name) | æ ¹æ®å­—æ®µåè·å–å½“å‰ç±»çš„æŸä¸ªfieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰   |
| Field[] getFields()          | è·å–æ‰€æœ‰publicçš„fieldï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰               |
| Field[] getDeclaredFields()  | è·å–å½“å‰ç±»çš„æ‰€æœ‰fieldï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰             |

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```java
public class TestReflection3 {
    
    public static void main(String[] args) throws Exception {
        Object p = new Student("li hua");
        Class c = p.getClass();
        Field f = c.getDeclaredField("name");//è·å–å±æ€§
        f.setAccessible(true);//å…è®¸è®¿é—®
        Object val= f.get(p);
        System.out.println(val);
    }


    static class Student {
        private String name;

        public Student(String name) {
            this.name = name;
        }
    }
}
```

ç»“æœï¼š

```java
li hua
```

æˆ‘ä»¬å¯ä»¥å‘ç° **åå°„å¯ä»¥ç ´åç±»çš„å°è£…**

## è°ƒç”¨æ–¹æ³•

| **Method getMethod(name, Class...)**     | **è·å–æŸä¸ªpublicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰** |
| ---------------------------------------- | -------------------------------------- |
| Method getDeclaredMethod(name, Class...) | è·å–å½“å‰ç±»çš„æŸä¸ªMethodï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰   |
| Method[] getMethods()                    | è·å–æ‰€æœ‰publicçš„Methodï¼ˆåŒ…æ‹¬çˆ¶ç±»ï¼‰     |
| Method[] getDeclaredMethods()            | è·å–å½“å‰ç±»çš„æ‰€æœ‰Methodï¼ˆä¸åŒ…æ‹¬çˆ¶ç±»ï¼‰   |

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªä¾‹å­ï¼š

```java
public class TestReflection4 {

    public static void main(String[] args) throws Exception {

        //è·å–ç§æœ‰æ–¹æ³•ï¼Œéœ€è¦ä¼ å‚ï¼šæ–¹æ³•åå’Œå‚æ•°
        Method h = Student.class.getDeclaredMethod("setName",String.class);

        h.setAccessible(true);

        Student s1 =new Student();
        System.out.println(s1.name);
        //ä¼ å…¥ç›®æ ‡å¯¹è±¡ï¼Œè°ƒç”¨å¯¹åº”çš„æ–¹æ³•
        h.invoke(s1,"xiao ming");
        System.out.println(s1.name);
    }


    static class Student {
        private String name;

        private void setName(String name) {
            this.name = name;
        }
    }
}
```

ç»“æœï¼š

```java
null  xiao ming
```

æˆ‘ä»¬å‘ç°è·å–æ–¹æ³•getMethod()æ—¶ï¼Œéœ€è¦ä¼ å‚ **æ–¹æ³•åå’Œå‚æ•°**

è¿™æ˜¯å› ä¸º.classæ–‡ä»¶ä¸­é€šå¸¸æœ‰ **ä¸æ­¢ä¸€ä¸ªæ–¹æ³•** ï¼Œè·å–æ–¹æ³•getMethod()æ—¶,ä¼šå»è°ƒç”¨searchMethodsæ–¹æ³•å¾ªç¯éå†æ‰€æœ‰Methodï¼Œç„¶åæ ¹æ® **æ–¹æ³•åå’Œå‚æ•°ç±»å‹** æ‰¾åˆ°å”¯ä¸€ç¬¦åˆçš„Methodè¿”å›ã€‚

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-30/8e8e454e-3e00-4a59-890b-1396eaa3e0eb_reflect06.png)



æˆ‘ä»¬çŸ¥é“ç±»çš„æ–¹æ³•æ˜¯åœ¨JVMçš„æ–¹æ³•åŒºä¸­ ï¼Œå½“æˆ‘ä»¬new å¤šä¸ªå¯¹è±¡æ—¶ï¼Œå±æ€§ä¼šå¦å¤–å¼€è¾Ÿå †ç©ºé—´å­˜æ”¾ï¼Œè€Œæ–¹æ³•åªæœ‰ä¸€ä»½ï¼Œä¸ä¼šé¢å¤–æ¶ˆè€—å†…å­˜ï¼Œæ–¹æ³•å°±åƒä¸€å¥—æŒ‡ä»¤æ¨¡æ¿ï¼Œè°éƒ½å¯ä»¥ä¼ å…¥æ•°æ®äº¤ç»™å®ƒæ‰§è¡Œï¼Œç„¶åå¾—åˆ°å¯¹åº”æ‰§è¡Œç»“æœã€‚

method.invoke(obj, args) æ—¶ä¼ å…¥ç›®æ ‡å¯¹è±¡ï¼Œå³å¯è°ƒç”¨å¯¹åº”å¯¹è±¡çš„æ–¹æ³•

å¦‚æœè·å–åˆ°çš„Methodè¡¨ç¤ºä¸€ä¸ªé™æ€æ–¹æ³•ï¼Œè°ƒç”¨é™æ€æ–¹æ³•æ—¶ï¼Œ **æ— éœ€æŒ‡å®šå®ä¾‹å¯¹è±¡** ï¼Œæ‰€ä»¥invokeæ–¹æ³•ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°æ°¸è¿œä¸ºnull, method.invoke(null, args)

é‚£å¦‚æœ æ–¹æ³•é‡å†™äº†å‘¢ï¼Œ **åå°„ä¾æ—§éµå¾ª å¤šæ€ çš„åŸåˆ™** ã€‚

# åå°„çš„åº”ç”¨åœºæ™¯

å¦‚æœå¹³æ—¶æˆ‘ä»¬åªæ˜¯å†™ä¸šåŠ¡ä»£ç ,å¾ˆå°‘ä¼šæ¥è§¦åˆ°ç›´æ¥ä½¿ç”¨åå°„æœºåˆ¶çš„åœºæ™¯ï¼Œæ¯•ç«Ÿæˆ‘ä»¬å¯ä»¥ç›´æ¥newä¸€ä¸ªå¯¹è±¡ï¼Œæ€§èƒ½æ¯”è¿˜åå°„è¦é«˜ã€‚

ä½†å¦‚æœæˆ‘ä»¬æ˜¯å·¥å…·æ¡†æ¶çš„å¼€å‘è€…,é‚£ä¸€å®šéå¸¸ç†Ÿæ‚‰,åƒ Spring/Spring Bootã€MyBatis ç­‰ç­‰æ¡†æ¶ä¸­éƒ½å¤§é‡ä½¿ç”¨åå°„æœºåˆ¶ï¼Œ **åå°„è¢«ç§°ä¸ºæ¡†æ¶çš„çµé­‚**

æ¯”å¦‚ï¼š

1. Mybatis Pluså¯ä»¥è®©æˆ‘ä»¬åªå†™æ¥å£ï¼Œä¸å†™å®ç°ç±»ï¼Œå°±å¯ä»¥æ‰§è¡ŒSQL
2. å¼€å‘é¡¹ç›®æ—¶ï¼Œåˆ‡æ¢ä¸åŒçš„æ•°æ®åº“åªéœ€æ›´æ”¹é…ç½®æ–‡ä»¶å³å¯
3. ç±»ä¸ŠåŠ ä¸Š@Componentæ³¨è§£ï¼ŒSpringå°±å¸®æˆ‘ä»¬åˆ›å»ºå¯¹è±¡
4. åœ¨Springæˆ‘ä»¬åªéœ€ @Valueæ³¨è§£å°±è¯»å–åˆ°é…ç½®æ–‡ä»¶ä¸­çš„å€¼
5. ç­‰ç­‰

# æ‰©å±•ï¼šåå°„é…ç½®æ–‡ä»¶

æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªé…ç½®é«˜äºç¼–ç çš„ä¾‹å­

æ–°å»ºmy.propertiesï¼Œå°†å…¶æ”¾åœ¨resourcesçš„ç›®å½•ä¸‹

```java
#Personç±»çš„åŒ…è·¯å¾„
className=com.zj.demotest.domain.Person 
methodName=eat
```

Personç±» è¿˜æ˜¯æœ¬æ–‡ ä¸€ç›´ç”¨çš„ï¼Œåœ¨æ–‡ç« çš„å¼€å¤´æœ‰

æœ€åæˆ‘ä»¬æ¥ç¼–å†™ä¸€ä¸ªæµ‹è¯•ç±»

```java
public class TestProp {
    public static void main(String[] args) throws IOException, ClassNotFoundException, IllegalAccessException, InstantiationException, NoSuchMethodException, InvocationTargetException {

        Properties properties = new Properties();

        ClassLoader classLoader = TestProp.class.getClassLoader();
        InputStream inputStream = classLoader.getResourceAsStream("my.properties");// åŠ è½½é…ç½®æ–‡ä»¶
        properties.load(inputStream);

        String className = properties.getProperty("className");
        System.out.println("é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šclassName="+className);
        String methodName = properties.getProperty("methodName");
        System.out.println("é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šmethodName="+methodName);

        Class name = Class.forName(className);
        Object object = name.newInstance();

        Method method = name.getMethod(methodName);
        method.invoke(object);
    }
}
```

ç»“æœï¼š

```java

é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šclassName=com.zj.demotest.domain.Person

é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šmethodName=eat

åƒé¥­
```

ç´§æ¥ç€ï¼Œæˆ‘ä»¬ä¿®æ”¹é…ç½®æ–‡ä»¶:

```java
className=com.zj.demotest.domain.Person
methodName=eat
```

ç»“æœå˜ä¸ºï¼š

```java
é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šclassName=com.zj.demotest.domain.Person

é…ç½®æ–‡ä»¶ä¸­çš„å†…å®¹ï¼šmethodName=Dance

è·³èˆ
```

æ˜¯ä¸æ˜¯å¾ˆæ–¹ä¾¿ï¼Ÿ![img](https://p3-sign.toutiaoimg.com/tos-cn-i-qvj2lq49k0/38db7ced63c84292a4cd52d34de1aaac~noop.image?_iz=58558&from=article.pc_detail&x-expires=1665133054&x-signature=o2EdYWXcPgb9pzn0Xp%2FAHkMqOF0%3D)

# å°¾è¯­

åå°„æœºåˆ¶æ˜¯ä¸€ç§åŠŸèƒ½å¼ºå¤§çš„æœºåˆ¶ï¼Œè®©Javaç¨‹åºå…·æœ‰åœ¨ **è¿è¡ŒæœŸ** åˆ†æç±»ä»¥åŠä¿®æ”¹å…¶æœ¬èº«çŠ¶æ€æˆ–è¡Œä¸ºçš„èƒ½åŠ› ã€‚

å¯¹äºç‰¹å®šçš„å¤æ‚ç³»ç»Ÿç¼–ç¨‹ä»»åŠ¡ï¼Œå®ƒæ˜¯éå¸¸å¿…è¦çš„ï¼Œä¸ºå„ç§æ¡†æ¶æä¾›å¼€ç®±å³ç”¨çš„åŠŸèƒ½æä¾›äº†ä¾¿åˆ©ï¼Œä¸ºè§£è€¦åˆæä¾›äº†ä¿éšœæœºåˆ¶ã€‚

ä½†æ˜¯ä¸–äº‹æ— ç»å¯¹ï¼Œåå°„ç›¸å½“äºä¸€ç³»åˆ—è§£é‡Šæ“ä½œï¼Œé€šçŸ¥ JVM è¦åšçš„äº‹æƒ…ï¼Œæ€§èƒ½æ¯”ç›´æ¥è®¿é—®å¯¹è±¡è¦å·®ç‚¹ï¼ˆJITä¼˜åŒ–åï¼Œå¯¹äºæ¡†æ¶æ¥è¯´å®é™…æ˜¯å½±å“ä¸å¤§çš„ï¼‰ï¼Œè¿˜ä¼šå¢åŠ ç¨‹åºçš„å¤æ‚æ€§ç­‰ï¼ˆæ˜æ˜ç›´æ¥newä¸€ä¸‹å°±èƒ½è§£å†³çš„äº‹æƒ…ï¼Œéè¦å†™ä¸€å¤§æ®µä»£ç ï¼‰ã€‚



# å‚è€ƒæ–‡ç« 

- [JAVAåå°„æœºåˆ¶è¯¦è§£ï¼Œä¸€å­¦å°±ä¼š](https://www.toutiao.com/article/7127883704642994696/?app=news_article&timestamp=1664528092&use_new_style=1&req_id=20220930165451010150170203114AA724&group_id=7127883704642994696&share_token=1C7B6439-C16A-40C9-8964-21BB6DD5BBCF&tt_from=copy_link&utm_source=copy_link&utm_medium=toutiao_ios&utm_campaign=client_share&source=m_redirect)

