# ğŸ¥› Java8 æ–°ç‰¹æ€§ - å‡½æ•°å¼æ¥å£

---

## æ¦‚å¿µ

### èƒŒæ™¯

Lambda çš„è®¾è®¡è€…ä»¬ä¸ºäº†è®©ç°æœ‰çš„åŠŸèƒ½ä¸ Lambda è¡¨è¾¾å¼è‰¯å¥½å…¼å®¹ï¼Œè€ƒè™‘äº†å¾ˆå¤šæ–¹æ³•ï¼Œäºæ˜¯äº§ç”Ÿäº†å‡½æ•°æ¥å£è¿™ä¸ªæ¦‚å¿µã€‚



### ä»€ä¹ˆæ˜¯å‡½æ•°å¼æ¥å£ï¼Ÿ

`å‡½æ•°å¼æ¥å£`æŒ‡çš„æ˜¯ä¸€ä¸ª**æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•**ï¼Œä½†æ˜¯**å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•**çš„æ¥å£ï¼Œè¿™æ ·çš„æ¥å£å¯ä»¥éšå¼è½¬æ¢ä¸º Lambda è¡¨è¾¾å¼ã€‚

ä½†æ˜¯åœ¨å®è·µä¸­ï¼Œå‡½æ•°å¼æ¥å£éå¸¸è„†å¼±ï¼Œåªè¦æŸä¸ªå¼€å‘è€…åœ¨è¯¥æ¥å£ä¸­æ·»åŠ ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™è¯¥æ¥å£å°±ä¸å†æ˜¯å‡½æ•°å¼æ¥å£è¿›è€Œå¯¼è‡´ç¼–è¯‘å¤±è´¥ã€‚ä¸ºäº†å…‹æœè¿™ç§ä»£ç å±‚é¢çš„è„†å¼±æ€§ï¼Œå¹¶æ˜¾å¼è¯´æ˜æŸä¸ªæ¥å£æ˜¯å‡½æ•°å¼æ¥å£ï¼ŒJava 8 æä¾›äº†ä¸€ä¸ªç‰¹æ®Šçš„æ³¨è§£`@FunctionalInterface`ï¼Œä¸¾ä¸ªç®€å•çš„å‡½æ•°å¼æ¥å£çš„å®šä¹‰ï¼š

```java
@FunctionalInterfaceÂ 
publicÂ interfaceÂ GreetingServiceÂ {Â 
Â Â Â Â voidÂ sayMessage(StringÂ message);Â 
}Â 
```

Java7 åªèƒ½é€šè¿‡åŒ¿åå†…éƒ¨ç±»è¿›è¡Œç¼–ç¨‹ï¼Œä¾‹å¦‚ï¼š

```java
GreetingServiceÂ greetServiceÂ =Â newÂ GreetingService()Â {Â 
Â 
Â Â Â Â @OverrideÂ 
Â Â Â Â publicÂ voidÂ sayMessage(StringÂ message)Â {Â 
Â Â Â Â Â Â Â Â System.out.println("HelloÂ "Â +Â message);Â 
Â Â Â Â }Â 
};Â 
greetService.sayMessage("world");Â 
```

Java8 å¯ä»¥é‡‡ç”¨ Lambda è¡¨è¾¾æ–¹è¿›è¡Œç¼–ç¨‹ï¼Œä¾‹å¦‚ï¼š

```java
GreetingServiceÂ greetServiceÂ =Â messageÂ ->Â System.out.println("HelloÂ "Â +Â message);Â 
greetService.sayMessage("world");Â 
```

ç›®å‰ Java åº“ä¸­çš„æ‰€æœ‰ç›¸å…³æ¥å£éƒ½å·²ç»å¸¦æœ‰è¿™ä¸ªæ³¨è§£äº†ï¼Œå®è·µä¸Š**java.lang.Runnable**å’Œ**java.util.concurrent.Callable**æ˜¯å‡½æ•°å¼æ¥å£çš„æœ€ä½³ä¾‹å­!



## @FunctionalInterfaceæ³¨è§£

Java 8ä¸ºå‡½æ•°å¼æ¥å£å¼•å…¥äº†ä¸€ä¸ªæ–°æ³¨è§£`@FunctionalInterface`ï¼Œä¸»è¦ç”¨äº**ç¼–è¯‘çº§é”™è¯¯æ£€æŸ¥**ï¼ŒåŠ ä¸Šè¯¥æ³¨è§£ï¼Œå½“ä½ å†™çš„æ¥å£ä¸ç¬¦åˆå‡½æ•°å¼æ¥å£å®šä¹‰çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ã€‚

**æ­£ç¡®ä¾‹å­**ï¼Œæ²¡æœ‰æŠ¥é”™ï¼š

```java
/**
 * @Description FunctionalInterface
 * @Author vchicken
 * @Date 2022/9/24 14:46
 */
@FunctionalInterface
public interface TestFunctionalInterface {

    void sayMessage(String message);
    
}
```

**é”™è¯¯ä¾‹å­**ï¼Œæ¥å£ä¸­åŒ…å«äº†ä¸¤ä¸ªæŠ½è±¡æ–¹æ³•ï¼Œè¿åäº†å‡½æ•°å¼æ¥å£çš„å®šä¹‰ï¼ŒEclipseæŠ¥é”™æç¤ºå…¶ä¸æ˜¯å‡½æ•°å¼æ¥å£ã€‚

![img](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-24/2a3bad8c-4775-456f-8112-b63188436c4b_æ³¨è§£@FunctionalInterfaceåä¾‹.png)

**æé†’ï¼šåŠ ä¸åŠ @FunctionalInterfaceå¯¹äºæ¥å£æ˜¯ä¸æ˜¯å‡½æ•°å¼æ¥å£æ²¡æœ‰å½±å“ï¼Œè¯¥æ³¨è§£çŸ¥è¯†æé†’ç¼–è¯‘å™¨å»æ£€æŸ¥è¯¥æ¥å£æ˜¯å¦ä»…åŒ…å«ä¸€ä¸ªæŠ½è±¡æ–¹æ³•ã€‚**



### å†…ç½®å››å¤§å‡½æ•°æ¥å£

- **æ¶ˆè´¹å‹æ¥å£**: Consumer< T> void accept(T t)æœ‰å‚æ•°ï¼Œæ— è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•ï¼›

> æ¯”å¦‚: map.forEach(BiConsumer<A, T>)

```java
Consumer<Person> greeter = (p) -> System.out.println("Hello, " + p.firstName);
greeter.accept(new Person("Luke", "Skywalker"));
```

- **ä¾›ç»™å‹æ¥å£**: Supplier < T> T get() æ— å‚æœ‰è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•ï¼›

> ä»¥stream().collect(Collector<? super T, A, R> collector)ä¸ºä¾‹:

æ¯”å¦‚:

```java
Supplier<Person> personSupplier = Person::new;
personSupplier.get();   // new Person
```

å†å¦‚:

```java
// è°ƒç”¨æ–¹æ³•
<R, A> R collect(Collector<? super T, A, R> collector)

// Collectors.toSet
public static <T>
	Collector<T, ?, Set<T>> toSet() {
    	return new CollectorImpl<>((Supplier<Set<T>>) HashSet::new, Set::add,
                               (left, right) -> { left.addAll(right); return left; },
                               CH_UNORDERED_ID);
}

// CollectorImpl
private final Supplier<A> supplier;
private final BiConsumer<A, T> accumulator;
private final BinaryOperator<A> combiner;
private final Function<A, R> finisher;
private final Set<Characteristics> characteristics;

CollectorImpl(Supplier<A> supplier,
              BiConsumer<A, T> accumulator,
              BinaryOperator<A> combiner,
              Function<A,R> finisher,
              Set<Characteristics> characteristics) {
    this.supplier = supplier;
    this.accumulator = accumulator;
    this.combiner = combiner;
    this.finisher = finisher;
    this.characteristics = characteristics;
}

CollectorImpl(Supplier<A> supplier,
              BiConsumer<A, T> accumulator,
              BinaryOperator<A> combiner,
              Set<Characteristics> characteristics) {
    this(supplier, accumulator, combiner, castingIdentity(), characteristics);
}

// collect()æ–¹æ³•å®ç°
public final <R, A> R collect(Collector<? super P_OUT, A, R> collector) {
    A container;
    if (isParallel()
            && (collector.characteristics().contains(Collector.Characteristics.CONCURRENT))
            && (!isOrdered() || collector.characteristics().contains(Collector.Characteristics.UNORDERED))) {
        container = collector.supplier().get();
        BiConsumer<A, ? super P_OUT> accumulator = collector.accumulator();
        forEach(u -> accumulator.accept(container, u));
    }
    else {
        container = evaluate(ReduceOps.makeRef(collector));
    }
    return collector.characteristics().contains(Collector.Characteristics.IDENTITY_FINISH)
           ? (R) container
           : collector.finisher().apply(container);
}   
```

- **æ–­å®šå‹æ¥å£**:  Predicate<T> boolean test(T t):æœ‰å‚ï¼Œä½†æ˜¯è¿”å›å€¼ç±»å‹æ˜¯å›ºå®šçš„boolean

> æ¯”å¦‚: steam().filter()ä¸­å‚æ•°å°±æ˜¯Predicate

```java
Predicate<String> predicate = (s) -> s.length() > 0;

predicate.test("foo");              // true
predicate.negate().test("foo");     // false

Predicate<Boolean> nonNull = Objects::nonNull;
Predicate<Boolean> isNull = Objects::isNull;

Predicate<String> isEmpty = String::isEmpty;
Predicate<String> isNotEmpty = isEmpty.negate();
```

- **å‡½æ•°å‹æ¥å£**:  Function<T,R> R apply(T t)æœ‰å‚æœ‰è¿”å›å€¼çš„æŠ½è±¡æ–¹æ³•ï¼›

> æ¯”å¦‚:  steam().map() ä¸­å‚æ•°å°±æ˜¯Function<? super T, ? extends R>ï¼›reduce()ä¸­å‚æ•°BinaryOperator<T> (ps: BinaryOperator<T> extends BiFunction<T,T,T>)

```java
Function<String, Integer> toInteger = Integer::valueOf;
Function<String, String> backToString = toInteger.andThen(String::valueOf);
backToString.apply("123");     // "123"
```

> [æ›´å¤šå†…å®¹ç‚¹å‡»é˜…è¯»æ­¤æ–‡](java/æ–°ç‰¹æ€§/Java8/å››å¤§å‡½æ•°å¼æ¥å£)



## å…¶ä»–ç”¨æ³•

### å…è®¸å®šä¹‰é»˜è®¤æ–¹æ³•

å‡½æ•°å¼æ¥å£é‡Œæ˜¯å¯ä»¥åŒ…å«é»˜è®¤æ–¹æ³•ï¼Œå› ä¸ºé»˜è®¤æ–¹æ³•ä¸æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œå…¶æœ‰ä¸€ä¸ªé»˜è®¤å®ç°ï¼Œæ‰€ä»¥æ˜¯ç¬¦åˆå‡½æ•°å¼æ¥å£çš„å®šä¹‰çš„â€”â€”ä¸€ä¸ª**æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªæŠ½è±¡æ–¹æ³•**ï¼Œä½†æ˜¯**å¯ä»¥æœ‰å¤šä¸ªéæŠ½è±¡æ–¹æ³•**çš„æ¥å£ã€‚

å¦‚ä¸‹ä»£ç ä¸ä¼šæŠ¥é”™ï¼š

```java
    @FunctionalInterface
    interface GreetingService
    {
        void sayMessage(String message);

        default void doSomeMoreWork1()
        {
            // Method body
        }

        default void doSomeMoreWork2()
        {
            // Method body
        }
    }
```

### å…è®¸å®šä¹‰é™æ€æ–¹æ³•

å‡½æ•°å¼æ¥å£é‡Œæ˜¯å¯ä»¥åŒ…å«é™æ€æ–¹æ³•ï¼Œå› ä¸ºé™æ€æ–¹æ³•ä¸èƒ½æ˜¯æŠ½è±¡æ–¹æ³•ï¼Œæ˜¯ä¸€ä¸ªå·²ç»å®ç°äº†çš„æ–¹æ³•ï¼Œæ‰€ä»¥æ˜¯ç¬¦åˆå‡½æ•°å¼æ¥å£çš„å®šä¹‰çš„ï¼›

å¦‚ä¸‹ä»£ç ä¸ä¼šæŠ¥é”™ï¼š

```java
    @FunctionalInterface
    interface GreetingService 
    {
        void sayMessage(String message);
        static void printHello(){
            System.out.println("Hello");
        }
    }
```

### å…è®¸å®šä¹‰java.lang.Objecté‡Œçš„publicæ–¹æ³•

å‡½æ•°å¼æ¥å£é‡Œæ˜¯å¯ä»¥åŒ…å«Objecté‡Œçš„publicæ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å¯¹äºå‡½æ•°å¼æ¥å£æ¥è¯´ï¼Œä¸è¢«å½“æˆæ˜¯æŠ½è±¡æ–¹æ³•ï¼ˆè™½ç„¶å®ƒä»¬æ˜¯æŠ½è±¡æ–¹æ³•ï¼‰ï¼›å› ä¸ºä»»ä½•ä¸€ä¸ªå‡½æ•°å¼æ¥å£çš„å®ç°ï¼Œé»˜è®¤éƒ½ç»§æ‰¿äº†Objectç±»ï¼ŒåŒ…å«äº†æ¥è‡ªjava.lang.Objecté‡Œå¯¹è¿™äº›æŠ½è±¡æ–¹æ³•çš„å®ç°ï¼›

å¦‚ä¸‹ä»£ç ä¸ä¼šæŠ¥é”™ï¼š

```java
    @FunctionalInterface
    interface GreetingService  
    {
        void sayMessage(String message);
        
        @Override
        boolean equals(Object obj);
    }
```



## JDKä¸­çš„å‡½æ•°å¼æ¥å£ä¸¾ä¾‹

- java.lang.Runnable
- java.awt.event.ActionListener,
- java.util.Comparator
- java.util.concurrent.Callable
- java.util.functionåŒ…ä¸‹çš„æ¥å£ï¼Œå¦‚Consumerã€Predicateã€Supplierç­‰



## å‚è€ƒæ–‡ç« 

- [Java8 æ–°ç‰¹æ€§å…¨é¢ä»‹ç»ï¼Œå¼ºçƒˆå»ºè®®æ”¶è—](https://www.51cto.com/article/647804.html)
- [JAVA 8 å‡½æ•°å¼æ¥å£ - Functional Interface](https://www.cnblogs.com/chenpi/p/5890144.html)