**<span style="font-size: 35px;">ğŸ¥‘ PriorityQueueæºç è§£æ</span>**

---

## æ¦‚è¿°

å‰é¢ä»¥Java *ArrayDeque*ä¸ºä¾‹è®²è§£äº†*Stack*å’Œ*Queue*ï¼Œå…¶å®è¿˜æœ‰ä¸€ç§ç‰¹æ®Šçš„é˜Ÿåˆ—å«åš*PriorityQueue*ï¼Œå³ä¼˜å…ˆé˜Ÿåˆ—ã€‚**ä¼˜å…ˆé˜Ÿåˆ—çš„ä½œç”¨æ˜¯èƒ½ä¿è¯æ¯æ¬¡å–å‡ºçš„å…ƒç´ éƒ½æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„**(Javaçš„ä¼˜å…ˆé˜Ÿåˆ—æ¯æ¬¡å–æœ€å°å…ƒç´ ï¼ŒC++çš„ä¼˜å…ˆé˜Ÿåˆ—æ¯æ¬¡å–æœ€å¤§å…ƒç´ )ã€‚è¿™é‡Œç‰µæ¶‰åˆ°äº†å¤§å°å…³ç³»ï¼Œ**å…ƒç´ å¤§å°çš„è¯„åˆ¤å¯ä»¥é€šè¿‡å…ƒç´ æœ¬èº«çš„è‡ªç„¶é¡ºåº(\*natural ordering\*)ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ—¶ä¼ å…¥çš„æ¯”è¾ƒå™¨**(*Comparator*ï¼Œç±»ä¼¼äºC++çš„ä»¿å‡½æ•°)ã€‚

Javaä¸­*PriorityQueue*å®ç°äº†*Queue*æ¥å£ï¼Œä¸å…è®¸æ”¾å…¥`null`å…ƒç´ ï¼›å…¶é€šè¿‡å †å®ç°ï¼Œå…·ä½“è¯´æ˜¯é€šè¿‡å®Œå…¨äºŒå‰æ ‘(*complete binary tree*)å®ç°çš„**å°é¡¶å †**(ä»»æ„ä¸€ä¸ªéå¶å­èŠ‚ç‚¹çš„æƒå€¼ï¼Œéƒ½ä¸å¤§äºå…¶å·¦å³å­èŠ‚ç‚¹çš„æƒå€¼)ï¼Œä¹Ÿå°±æ„å‘³ç€å¯ä»¥é€šè¿‡æ•°ç»„æ¥ä½œä¸º*PriorityQueue*çš„åº•å±‚å®ç°ã€‚

![PriorityQueue_base.png](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-10/e68997c2-4422-4aa7-8e3d-e397faa7430e_PriorityQueue_base.png)

ä¸Šå›¾ä¸­æˆ‘ä»¬ç»™æ¯ä¸ªå…ƒç´ æŒ‰ç…§å±‚åºéå†çš„æ–¹å¼è¿›è¡Œäº†ç¼–å·ï¼Œå¦‚æœä½ è¶³å¤Ÿç»†å¿ƒï¼Œä¼šå‘ç°çˆ¶èŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„ç¼–å·æ˜¯æœ‰è”ç³»çš„ï¼Œæ›´ç¡®åˆ‡çš„è¯´çˆ¶å­èŠ‚ç‚¹çš„ç¼–å·ä¹‹é—´æœ‰å¦‚ä¸‹å…³ç³»:

```
leftNo = parentNo*2+1
rightNo = parentNo*2+2
parentNo = (nodeNo-1)/2
```

é€šè¿‡ä¸Šè¿°ä¸‰ä¸ªå…¬å¼ï¼Œå¯ä»¥è½»æ˜“è®¡ç®—å‡ºæŸä¸ªèŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ä»¥åŠå­èŠ‚ç‚¹çš„ä¸‹æ ‡ã€‚è¿™ä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆå¯ä»¥ç›´æ¥ç”¨æ•°ç»„æ¥å­˜å‚¨å †çš„åŸå› ã€‚

*PriorityQueue*çš„`peek()`å’Œ`element`æ“ä½œæ˜¯å¸¸æ•°æ—¶é—´ï¼Œ`add()`, `offer()`, æ— å‚æ•°çš„`remove()`ä»¥åŠ`poll()`æ–¹æ³•çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯*log(N)*ã€‚

## æ–¹æ³•å‰–æ

### add()å’Œoffer()

`add(E e)`å’Œ`offer(E e)`çš„è¯­ä¹‰ç›¸åŒï¼Œéƒ½æ˜¯å‘ä¼˜å…ˆé˜Ÿåˆ—ä¸­æ’å…¥å…ƒç´ ï¼Œåªæ˜¯`Queue`æ¥å£è§„å®šäºŒè€…å¯¹æ’å…¥å¤±è´¥æ—¶çš„å¤„ç†ä¸åŒï¼Œå‰è€…åœ¨æ’å…¥å¤±è´¥æ—¶æŠ›å‡ºå¼‚å¸¸ï¼Œååˆ™åˆ™ä¼šè¿”å›`false`ã€‚å¯¹äº*PriorityQueue*è¿™ä¸¤ä¸ªæ–¹æ³•å…¶å®æ²¡ä»€ä¹ˆå·®åˆ«ã€‚

![PriorityQueue_offer.png](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-10/6d7db0d5-e2a6-49f2-86ed-7b3e78739611_PriorityQueue_offer.png)

æ–°åŠ å…¥çš„å…ƒç´ å¯èƒ½ä¼šç ´åå°é¡¶å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚

```java
//offer(E e)
public boolean offer(E e) {
    if (e == null)//ä¸å…è®¸æ”¾å…¥nullå…ƒç´ 
        throw new NullPointerException();
    modCount++;
    int i = size;
    if (i >= queue.length)
        grow(i + 1);//è‡ªåŠ¨æ‰©å®¹
    size = i + 1;
    if (i == 0)//é˜Ÿåˆ—åŸæ¥ä¸ºç©ºï¼Œè¿™æ˜¯æ’å…¥çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
        queue[0] = e;
    else
        siftUp(i, e);//è°ƒæ•´
    return true;
} 
```

ä¸Šè¿°ä»£ç ä¸­ï¼Œæ‰©å®¹å‡½æ•°`grow()`ç±»ä¼¼äº`ArrayList`é‡Œçš„`grow()`å‡½æ•°ï¼Œå°±æ˜¯å†ç”³è¯·ä¸€ä¸ªæ›´å¤§çš„æ•°ç»„ï¼Œå¹¶å°†åŸæ•°ç»„çš„å…ƒç´ å¤åˆ¶è¿‡å»ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚éœ€è¦æ³¨æ„çš„æ˜¯`siftUp(int k, E x)`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ç”¨äºæ’å…¥å…ƒç´ `x`å¹¶ç»´æŒå †çš„ç‰¹æ€§ã€‚

```java
//siftUp()
private void siftUp(int k, E x) {
    while (k > 0) {
        int parent = (k - 1) >>> 1;//parentNo = (nodeNo-1)/2
        Object e = queue[parent];
        if (comparator.compare(x, (E) e) >= 0)//è°ƒç”¨æ¯”è¾ƒå™¨çš„æ¯”è¾ƒæ–¹æ³•
            break;
        queue[k] = e;
        k = parent;
    }
    queue[k] = x;
}
```

æ–°åŠ å…¥çš„å…ƒç´ `x`å¯èƒ½ä¼šç ´åå°é¡¶å †çš„æ€§è´¨ï¼Œå› æ­¤éœ€è¦è¿›è¡Œè°ƒæ•´ã€‚è°ƒæ•´çš„è¿‡ç¨‹ä¸º** : ä»`k`æŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†`x`é€å±‚ä¸å½“å‰ç‚¹çš„`parent`è¿›è¡Œæ¯”è¾ƒå¹¶äº¤æ¢ï¼Œç›´åˆ°æ»¡è¶³`x >= queue[parent]`ä¸ºæ­¢**ã€‚æ³¨æ„è¿™é‡Œçš„æ¯”è¾ƒå¯ä»¥æ˜¯å…ƒç´ çš„è‡ªç„¶é¡ºåºï¼Œä¹Ÿå¯ä»¥æ˜¯ä¾é æ¯”è¾ƒå™¨çš„é¡ºåºã€‚

### element()å’Œpeek()

`element()`å’Œ`peek()`çš„è¯­ä¹‰å®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–ä½†ä¸åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼Œä¹Ÿå°±æ˜¯é˜Ÿåˆ—ä¸­æƒå€¼æœ€å°çš„é‚£ä¸ªå…ƒç´ ï¼ŒäºŒè€…å”¯ä¸€çš„åŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›`null`ã€‚æ ¹æ®å°é¡¶å †çš„æ€§è´¨ï¼Œå †é¡¶é‚£ä¸ªå…ƒç´ å°±æ˜¯å…¨å±€æœ€å°çš„é‚£ä¸ªï¼›ç”±äºå †ç”¨æ•°ç»„è¡¨ç¤ºï¼Œæ ¹æ®ä¸‹æ ‡å…³ç³»ï¼Œ`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ æ—¢æ˜¯å †é¡¶å…ƒç´ ã€‚æ‰€ä»¥**ç›´æ¥è¿”å›æ•°ç»„`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å³å¯**ã€‚

![PriorityQueue_peek.png](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-10/cb32d96f-db4c-4409-8804-c929c0c30cdf_PriorityQueue_peek.png)

ä»£ç ä¹Ÿå°±éå¸¸ç®€æ´:

```java
//peek()
public E peek() {
    if (size == 0)
        return null;
    return (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª
}  
```

### remove()å’Œpoll()

`remove()`å’Œ`poll()`æ–¹æ³•çš„è¯­ä¹‰ä¹Ÿå®Œå…¨ç›¸åŒï¼Œéƒ½æ˜¯è·å–å¹¶åˆ é™¤é˜Ÿé¦–å…ƒç´ ï¼ŒåŒºåˆ«æ˜¯å½“æ–¹æ³•å¤±è´¥æ—¶å‰è€…æŠ›å‡ºå¼‚å¸¸ï¼Œåè€…è¿”å›`null`ã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—çš„ç»“æ„ï¼Œä¸ºç»´æŠ¤å°é¡¶å †çš„æ€§è´¨ï¼Œéœ€è¦è¿›è¡Œå¿…è¦çš„è°ƒæ•´ã€‚

![PriorityQueue_poll.png](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-10/4924d806-f176-4a3e-8c63-bd9452894b8c_PriorityQueue_poll.png) ä»£ç å¦‚ä¸‹:

```java
public E poll() {
    if (size == 0)
        return null;
    int s = --size;
    modCount++;
    E result = (E) queue[0];//0ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ å°±æ˜¯æœ€å°çš„é‚£ä¸ª
    E x = (E) queue[s];
    queue[s] = null;
    if (s != 0)
        siftDown(0, x);//è°ƒæ•´
    return result;
}
```

ä¸Šè¿°ä»£ç é¦–å…ˆè®°å½•`0`ä¸‹æ ‡å¤„çš„å…ƒç´ ï¼Œå¹¶ç”¨æœ€åä¸€ä¸ªå…ƒç´ æ›¿æ¢`0`ä¸‹æ ‡ä½ç½®çš„å…ƒç´ ï¼Œä¹‹åè°ƒç”¨`siftDown()`æ–¹æ³•å¯¹å †è¿›è¡Œè°ƒæ•´ï¼Œæœ€åè¿”å›åŸæ¥`0`ä¸‹æ ‡å¤„çš„é‚£ä¸ªå…ƒç´ (ä¹Ÿå°±æ˜¯æœ€å°çš„é‚£ä¸ªå…ƒç´ )ã€‚é‡ç‚¹æ˜¯`siftDown(int k, E x)`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•çš„ä½œç”¨æ˜¯**ä»`k`æŒ‡å®šçš„ä½ç½®å¼€å§‹ï¼Œå°†`x`é€å±‚å‘ä¸‹ä¸å½“å‰ç‚¹çš„å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªäº¤æ¢ï¼Œç›´åˆ°`x`å°äºæˆ–ç­‰äºå·¦å³å­©å­ä¸­çš„ä»»ä½•ä¸€ä¸ªä¸ºæ­¢**ã€‚

```java
//siftDown()
private void siftDown(int k, E x) {
    int half = size >>> 1;
    while (k < half) {
    	//é¦–å…ˆæ‰¾åˆ°å·¦å³å­©å­ä¸­è¾ƒå°çš„é‚£ä¸ªï¼Œè®°å½•åˆ°cé‡Œï¼Œå¹¶ç”¨childè®°å½•å…¶ä¸‹æ ‡
        int child = (k << 1) + 1;//leftNo = parentNo*2+1
        Object c = queue[child];
        int right = child + 1;
        if (right < size &&
            comparator.compare((E) c, (E) queue[right]) > 0)
            c = queue[child = right];
        if (comparator.compare(x, (E) c) <= 0)
            break;
        queue[k] = c;//ç„¶åç”¨cå–ä»£åŸæ¥çš„å€¼
        k = child;
    }
    queue[k] = x;
} 
```

### remove(Object o)

`remove(Object o)`æ–¹æ³•ç”¨äºåˆ é™¤é˜Ÿåˆ—ä¸­è·Ÿ`o`ç›¸ç­‰çš„æŸä¸€ä¸ªå…ƒç´ (å¦‚æœæœ‰å¤šä¸ªç›¸ç­‰ï¼Œåªåˆ é™¤ä¸€ä¸ª)ï¼Œè¯¥æ–¹æ³•ä¸æ˜¯*Queue*æ¥å£å†…çš„æ–¹æ³•ï¼Œè€Œæ˜¯*Collection*æ¥å£çš„æ–¹æ³•ã€‚ç”±äºåˆ é™¤æ“ä½œä¼šæ”¹å˜é˜Ÿåˆ—ç»“æ„ï¼Œæ‰€ä»¥è¦è¿›è¡Œè°ƒæ•´ï¼›åˆç”±äºåˆ é™¤å…ƒç´ çš„ä½ç½®å¯èƒ½æ˜¯ä»»æ„çš„ï¼Œæ‰€ä»¥è°ƒæ•´è¿‡ç¨‹æ¯”å…¶å®ƒå‡½æ•°ç¨åŠ ç¹çã€‚å…·ä½“æ¥è¯´ï¼Œ`remove(Object o)`å¯ä»¥åˆ†ä¸º2ç§æƒ…å†µ: 1. åˆ é™¤çš„æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ã€‚ç›´æ¥åˆ é™¤å³å¯ï¼Œä¸éœ€è¦è°ƒæ•´ã€‚2. åˆ é™¤çš„ä¸æ˜¯æœ€åä¸€ä¸ªå…ƒç´ ï¼Œä»åˆ é™¤ç‚¹å¼€å§‹ä»¥æœ€åä¸€ä¸ªå…ƒç´ ä¸ºå‚ç…§è°ƒç”¨ä¸€æ¬¡`siftDown()`å³å¯ã€‚æ­¤å¤„ä¸å†èµ˜è¿°ã€‚

![PriorityQueue_remove2.png](https://vue-admin-imgages.oss-cn-hangzhou.aliyuncs.com/2022-09-10/28be9d02-a0be-4620-87fc-4da9dec9c2e5_PriorityQueue_remove2.png)

å…·ä½“ä»£ç å¦‚ä¸‹:

```java
//remove(Object o)
public boolean remove(Object o) {
	//é€šè¿‡éå†æ•°ç»„çš„æ–¹å¼æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³o.equals(queue[i])å…ƒç´ çš„ä¸‹æ ‡
    int i = indexOf(o);
    if (i == -1)
        return false;
    int s = --size;
    if (s == i) //æƒ…å†µ1
        queue[i] = null;
    else {
        E moved = (E) queue[s];
        queue[s] = null;
        siftDown(i, moved);//æƒ…å†µ2
        ......
    }
    return true;
}
```

## å‚è€ƒ

- [æ·±å…¥ç†è§£Java PriorityQueue ç»“åˆæºç å¯¹PriorityQueueè¿›è¡Œè®²è§£](http://www.cnblogs.com/CarpenterLee/p/5488070.html)